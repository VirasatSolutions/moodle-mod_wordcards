define(["jquery","core/ajax","core/log","mod_wordcards/a4e","mod_wordcards/keyboard","core/templates"],function(a,b,c,d,e,f){var g={dryRun:!1,init:function(b){var e="#"+b.widgetid;this.dryRun=b.dryRun,this.nexturl=b.nexturl,this.modid=b.modid;var f=a(e).get(0);if(!f)return void c.debug("No config found on page. Giving up.");var h=JSON.parse(f.value);a(e).remove(),g.process(h),d.register_events(),d.init_audio(b.token,b.region,b.owner),this.register_events()},register_events:function(){a("body").on("click","#close-results",function(){var a=g.timer.count,b=g.nexturl.replace(/&amp;/g,"&")+"&localscattertime="+a;window.location.replace(b)}),a("body").on("click","#try-again",function(){location.reload()}),a("body").on("click","#start-button",function(){g.start()})},process:function(a){g.terms=a.terms,g.has_images=a.has_images,d.list_vocab("#vocab-list-inner",g.terms)},start:function(){g.results=[],d.shuffle(g.terms),g.pointer=0,a("#vocab-list, #start-button").hide(),a("#gameboard").show(),a("#time-counter").text("00:00"),g.timer={interval:setInterval(function(){g.timer.update()},1e3),count:0,update:function(){g.timer.count++,a("#time-counter").text(d.pretty_print_secs(g.timer.count))}},g.next()},quit:function(){e.clear(),clearInterval(g.timer.interval),a("#gameboard").hide(),a("#vocab-list, #start-button").show()},end:function(){e.clear(),clearInterval(g.timer.interval),a("#gameboard, #start-button").hide(),a("#results").show();var c=[];c.results=g.results,c.total=g.terms.length,c.totalcorrect=d.calc_total_points(g.results);var h=g.timer.count;0==h?c.prettytime="00:00":c.prettytime=d.pretty_print_secs(h),f.render("mod_wordcards/feedback",c).then(function(b,c){a("#results-inner").html(b)});var i={results:g.results,activity:"match_type"};console.log(i),b.call([{methodname:"mod_wordcards_report_step_grade",args:{modid:g.modid,correct:c.totalcorrect}}])},next:function(){d.progress_dots(g.results,g.terms),a("#submitted").html("").removeClass("a4e-correct a4e-incorrect"),e.create("input",g.terms[g.pointer].term,g.pointer,!0,function(b){a("#submitted").html(g.terms[g.pointer].term),e.disable(),g.check(b)});var b="";g.terms[g.pointer].image&&(b+="<img class='a4e-prompt-img' src='"+g.terms[g.pointer].image+"'>"),b+="<strong>"+g.terms[g.pointer].definition+"</strong>",a("#question").html(b)},check:function(b){var c=b.toLowerCase().trim()==g.terms[g.pointer].term.toLowerCase().trim(),d=0;1==c?(a("#submitted").addClass("a4e-correct"),d=1):a("#submitted").addClass("a4e-incorrect"),c?this.reportSuccess(g.terms[g.pointer].id):this.reportFailure(g.terms[g.pointer].id,0);var e={question:g.terms[g.pointer].definition,selected:b,correct:g.terms[g.pointer].term,points:d};g.results.push(e),g.pointer<g.terms.length-1?(g.pointer++,setTimeout(function(){g.next()},1e3)):g.end()},reportFailure:function(a,c){this.dryRun||b.call([{methodname:"mod_wordcards_report_failed_association",args:{term1id:a,term2id:c}}])},reportSuccess:function(a){this.dryRun||b.call([{methodname:"mod_wordcards_report_successful_association",args:{termid:a}}])}};return g});