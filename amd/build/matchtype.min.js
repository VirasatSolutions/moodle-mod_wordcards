define(["jquery","core/ajax","core/log","mod_wordcards/a4e","mod_wordcards/keyboard"],function(a,b,c,d,e){var f={dryRun:!1,init:function(b){var e="#"+b.widgetid;this.dryRun=b.dryRun,this.nexturl=b.nexturl;var g=a(e).get(0);if(!g)return void c.debug("No config found on page. Giving up.");var h=JSON.parse(g.value);a(e).remove(),f.process(h),d.register_events(),this.register_events()},register_events:function(){a("#next-button").on("click",function(){f.next()}),a("#close-results").click(function(){a("#results").hide(),a("#start-button, #vocab-list").show()}),a("#start-button").click(function(){f.start()}),a("#quit-button").click(function(){f.quit()})},process:function(a){f.terms=a.terms,f.has_images=a.has_images,d.list_quizlet_vocab("#vocab-list",f.terms)},start:function(){f.results=[],d.shuffle(f.terms),f.pointer=0,a("#vocab-list, #start-button").hide(),a("#gameboard, #quit-button").show(),a("#time-counter").text("00:00"),a("#progress-correct").css("width","0%"),a("#progress-incorrect").css("width","0%"),f.timer={interval:setInterval(function(){f.timer.update()},1e3),count:0,update:function(){f.timer.count++,a("#time-counter").text(d.pretty_print_secs(f.timer.count))}},f.next()},quit:function(){e.clear(),clearInterval(f.timer.interval),a("#gameboard, #quit-button").hide(),a("#vocab-list, #start-button").show()},end:function(){e.clear(),clearInterval(f.timer.interval),a("#gameboard, #quit-button, #start-button").hide();var b=0;a.each(f.results,function(a,c){null!=c.time&&(b+=c.time)}),window.location.replace(this.nexturl.replace("&amp;","&")+"&localscattertime="+b)},OLDend:function(){e.clear(),clearInterval(f.timer.interval),a("#gameboard, #quit-button, #start-button").hide(),a("#results").show();var b=d.basic_feedback(f.results);b+=d.detailed_feedback(f.results),a("#results-inner").html(b);var c={results:f.results,activity:"match_type"};console.log(c)},next:function(){a("#next-button").hide(),a("#submitted").html("").removeClass("a4e-correct a4e-incorrect"),e.create("input",f.terms[f.pointer].term,f.pointer,!0,function(b){a("#submitted").html(f.terms[f.pointer].term),e.disable(),f.check(b)}),a("#question-counter").text(f.pointer+1+"/"+f.terms.length);var b={correct:f.results.filter(function(a){return a.points>0}).length/f.terms.length*100,incorrect:f.results.filter(function(a){return 0==a.points}).length/f.terms.length*100};a("#progress-correct").css("width",b.correct+"%"),a("#progress-incorrect").css("width",b.incorrect+"%"),a("#question").html(""),""!==f.terms[f.pointer].definition&&""!==f.terms[f.pointer].term?(null!==f.terms[f.pointer].image?a("#question").html("<img style='height:200px;width:auto;' class='center-block img-responsive img-thumbnail' src='"+f.terms[f.pointer].image.url+"'><br/>"):f.has_images&&null==f.terms[f.pointer].image&&a("#question").html("<img style='height:200px;width:auto;' class='center-block img-responsive img-thumbnail' src='/images/no-image.png'><br/>"),a("#question").append("<strong>"+f.terms[f.pointer].definition+"</strong>")):null!==f.terms[f.pointer].image?a("#question").html("<img class='center-block img-responsive img-thumbnail' src='"+f.terms[f.pointer].image.url+"'>"):(d.alert("Could not generate a test with these settings!","error"),f.end())},check:function(b){var c=b.toLowerCase().trim()==f.terms[f.pointer].term.toLowerCase().trim(),d=0;1==c?(a("#submitted").addClass("a4e-correct"),d=1):a("#submitted").addClass("a4e-incorrect"),c?this.reportSuccess(f.terms[f.pointer].id):this.reportFailure(f.terms[f.pointer].id,0);var e={question:f.terms[f.pointer].definition,selected:b,correct:f.terms[f.pointer].term,points:d,time:f.timer.count};f.timer.count=0,f.results.push(e),f.pointer<f.terms.length-1?(f.pointer++,c?setTimeout(function(){a("#next-button").trigger("click")},1e3):a("#next-button").show()):f.end()},reportFailure:function(a,c){this.dryRun||b.call([{methodname:"mod_wordcards_report_failed_association",args:{term1id:a,term2id:c}}])},reportSuccess:function(a){this.dryRun||b.call([{methodname:"mod_wordcards_report_successful_association",args:{termid:a}}])}};return f});