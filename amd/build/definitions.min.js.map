{"version":3,"sources":["../src/definitions.js"],"names":["define","$","Ajax","Notification","ModalFactory","str","ModalEvents","a4e","strings","init","opts","that","init_strings","theid","propscontrol","get","props","JSON","parse","value","remove","log","debug","container","modid","canmanage","canattempt","btn","find","register_events","init_audio","token","region","owner","seenAll","length","on","e","preventDefault","termNode","parents","first","termId","data","addClass","call","then","result","Deferred","reject","fail","exception","always","removeClass","prop","click","buttonhref","window","location","href","create","type","types","SAVE_CANCEL","title","reattempttitle","body","reattemptbody","modal","setSaveButtonText","reattempt","root","getRoot","save","show","get_strings","done","s","i"],"mappings":"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","sourcesContent":["define(['jquery', 'core/ajax', 'core/notification','core/modal_factory','core/str','core/modal_events', 'mod_wordcards/a4e'],\r\n    function($, Ajax, Notification,ModalFactory, str, ModalEvents, a4e) {\r\n  \"use strict\"; // jshint ;_;\r\n\r\n  return {\r\n\r\n    strings: {},\r\n\r\n    init: function(opts) {\r\n\r\n        var that = this;\r\n\r\n        //init strings\r\n        this.init_strings();\r\n\r\n        //pick up opts from html\r\n        var theid = '#' + opts['widgetid'];\r\n        var propscontrol = $(theid).get(0);\r\n        if (propscontrol) {\r\n            var props = JSON.parse(propscontrol.value);\r\n            this.props =props;\r\n            $(theid).remove();\r\n        } else {\r\n            //if there is no config we might as well give up\r\n            log.debug('No config found on page. Giving up.');\r\n            return;\r\n        }\r\n\r\n      var container = $('#definitions-page-' + opts['widgetid']),\r\n        modid = props.modid,\r\n        canmanage = props.canmanage,\r\n        canattempt = props.canattempt,\r\n        btn = container.find('.definitions-next');\r\n\r\n       //set up audio\r\n       a4e.register_events();\r\n       a4e.init_audio(props.token,props.region,props.owner);\r\n\r\n      function seenAll() {\r\n        return container.find('.term').length === container.find('.term.term-seen').length\r\n      }\r\n\r\n      container.on('click', '.term-seen-action', function(e) {\r\n        e.preventDefault();\r\n\r\n        var termNode = $(this).parents('.term').first(),\r\n          termId = termNode.data('termid');\r\n\r\n        // TODO Ajax.\r\n        termNode.addClass('term-loading');\r\n        Ajax.call([{\r\n            'methodname': 'mod_wordcards_mark_as_seen',\r\n            'args': {\r\n              'termid': termId\r\n            }\r\n          }])[0].then(function(result) {\r\n            if (!result) {\r\n              return $.Deferred().reject();\r\n            }\r\n            termNode.addClass('term-seen');\r\n          })\r\n          .fail(Notification.exception)\r\n          .always(function() {\r\n            termNode.removeClass('term-loading');\r\n            if (seenAll()) {\r\n              btn.prop('disabled', false);\r\n            }\r\n          });\r\n      });\r\n\r\n      // Teachers can jump to the next steps.\r\n      if (!seenAll() && !canmanage) {\r\n        btn.prop('disabled', true);\r\n      }\r\n\r\n      btn.click(function(e) {\r\n        e.preventDefault();\r\n        var buttonhref= $(this).data('href');\r\n\r\n        //f its not a reattempt ... proceed\r\n        if($(this).data('action')!=='reattempt') {\r\n            window.location.href = buttonhref;\r\n            return;\r\n        }\r\n\r\n        //if its a reattempt, confirm and proceed\r\n          ModalFactory.create({\r\n              type: ModalFactory.types.SAVE_CANCEL,\r\n              title: that.strings.reattempttitle,\r\n              body: that.strings.reattemptbody\r\n          })\r\n          .then(function(modal) {\r\n              modal.setSaveButtonText(that.strings.reattempt);\r\n              var root = modal.getRoot();\r\n              root.on(ModalEvents.save, function() {\r\n                  window.location.href = buttonhref;\r\n              });\r\n              modal.show();\r\n          });\r\n\r\n      });\r\n\r\n    },\r\n\r\n    init_strings: function(){\r\n        var that = this;\r\n        // set up strings\r\n        str.get_strings([\r\n            {\"key\": \"reattempttitle\",       \"component\": 'mod_wordcards'},\r\n            {\"key\": \"reattemptbody\",           \"component\": 'mod_wordcards'},\r\n            {\"key\": \"reattempt\",           \"component\": 'mod_wordcards'}\r\n\r\n        ]).done(function(s) {\r\n            var i = 0;\r\n            that.strings.reattempttitle = s[i++];\r\n            that.strings.reattemptbody = s[i++];\r\n            that.strings.reattempt = s[i++];\r\n        });\r\n    }\r\n\r\n  }\r\n\r\n});"],"file":"definitions.min.js"}