{"version":3,"sources":["../src/definitions.js"],"names":["define","$","Ajax","Notification","a4e","init","opts","theid","propscontrol","get","props","JSON","parse","value","remove","log","debug","container","modid","canmanage","btn","find","register_events","init_audio","token","region","owner","seenAll","length","on","e","preventDefault","termNode","parents","first","termId","data","addClass","call","then","result","Deferred","reject","fail","exception","always","removeClass","prop","click","location","href"],"mappings":"AAAAA,OAAM,6BAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,mBAAxB,CAA6C,mBAA7C,CAAD,CAAoE,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAgCC,CAAhC,CAAqC,CAC7G,aAEA,MAAO,CAELC,IAAI,CAAE,cAASC,CAAT,CAAe,IAGbC,CAAAA,CAAK,CAAG,IAAMD,CAAI,SAHL,CAIbE,CAAY,CAAGP,CAAC,CAACM,CAAD,CAAD,CAASE,GAAT,CAAa,CAAb,CAJF,CAKjB,GAAID,CAAJ,CAAkB,CACd,GAAIE,CAAAA,CAAK,CAAGC,IAAI,CAACC,KAAL,CAAWJ,CAAY,CAACK,KAAxB,CAAZ,CACA,KAAKH,KAAL,CAAYA,CAAZ,CACAT,CAAC,CAACM,CAAD,CAAD,CAASO,MAAT,EACH,CAJD,IAIO,CAEHC,GAAG,CAACC,KAAJ,CAAU,qCAAV,EACA,MACH,CAEH,GAAIC,CAAAA,CAAS,CAAGhB,CAAC,CAAC,qBAAuBK,CAAI,SAA5B,CAAjB,CACEY,CAAK,CAAGR,CAAK,CAACQ,KADhB,CAEEC,CAAS,CAAGT,CAAK,CAACS,SAFpB,CAGEC,CAAG,CAAGH,CAAS,CAACI,IAAV,CAAe,kBAAf,CAHR,CAMCjB,CAAG,CAACkB,eAAJ,GACAlB,CAAG,CAACmB,UAAJ,CAAeb,CAAK,CAACc,KAArB,CAA2Bd,CAAK,CAACe,MAAjC,CAAwCf,CAAK,CAACgB,KAA9C,EAED,QAASC,CAAAA,CAAT,EAAmB,CACjB,MAAOV,CAAAA,CAAS,CAACI,IAAV,CAAe,OAAf,EAAwBO,MAAxB,GAAmCX,CAAS,CAACI,IAAV,CAAe,iBAAf,EAAkCO,MAC7E,CAEDX,CAAS,CAACY,EAAV,CAAa,OAAb,CAAsB,mBAAtB,CAA2C,SAASC,CAAT,CAAY,CACrDA,CAAC,CAACC,cAAF,GAEA,GAAIC,CAAAA,CAAQ,CAAG/B,CAAC,CAAC,IAAD,CAAD,CAAQgC,OAAR,CAAgB,OAAhB,EAAyBC,KAAzB,EAAf,CACEC,CAAM,CAAGH,CAAQ,CAACI,IAAT,CAAc,QAAd,CADX,CAIAJ,CAAQ,CAACK,QAAT,CAAkB,cAAlB,EACAnC,CAAI,CAACoC,IAAL,CAAU,CAAC,CACP,WAAc,4BADP,CAEP,KAAQ,CACN,OAAUH,CADJ,CAFD,CAAD,CAAV,EAKM,CALN,EAKSI,IALT,CAKc,SAASC,CAAT,CAAiB,CAC3B,GAAI,CAACA,CAAL,CAAa,CACX,MAAOvC,CAAAA,CAAC,CAACwC,QAAF,GAAaC,MAAb,EACR,CACDV,CAAQ,CAACK,QAAT,CAAkB,WAAlB,CACD,CAVH,EAWGM,IAXH,CAWQxC,CAAY,CAACyC,SAXrB,EAYGC,MAZH,CAYU,UAAW,CACjBb,CAAQ,CAACc,WAAT,CAAqB,cAArB,EACA,GAAInB,CAAO,EAAX,CAAe,CACbP,CAAG,CAAC2B,IAAJ,CAAS,UAAT,IACD,CACF,CAjBH,CAkBD,CA1BD,EA6BA,GAAI,CAACpB,CAAO,EAAR,EAAc,CAACR,CAAnB,CAA8B,CAC5BC,CAAG,CAAC2B,IAAJ,CAAS,UAAT,IACD,CAED3B,CAAG,CAAC4B,KAAJ,CAAU,SAASlB,CAAT,CAAY,CACpBA,CAAC,CAACC,cAAF,GACAkB,QAAQ,CAACC,IAAT,CAAgBjD,CAAC,CAAC,IAAD,CAAD,CAAQmC,IAAR,CAAa,MAAb,CACjB,CAHD,CAKD,CApEI,CAwER,CA3EK,CAAN","sourcesContent":["define(['jquery', 'core/ajax', 'core/notification', 'mod_wordcards/a4e'], function($, Ajax, Notification, a4e) {\n  \"use strict\"; // jshint ;_;\n\n  return {\n\n    init: function(opts) {\n\n        //pick up opts from html\n        var theid = '#' + opts['widgetid'];\n        var propscontrol = $(theid).get(0);\n        if (propscontrol) {\n            var props = JSON.parse(propscontrol.value);\n            this.props =props;\n            $(theid).remove();\n        } else {\n            //if there is no config we might as well give up\n            log.debug('No config found on page. Giving up.');\n            return;\n        }\n\n      var container = $('#definitions-page-' + opts['widgetid']),\n        modid = props.modid,\n        canmanage = props.canmanage,\n        btn = container.find('.continue-button');\n\n       //set up audio\n       a4e.register_events();\n       a4e.init_audio(props.token,props.region,props.owner);\n\n      function seenAll() {\n        return container.find('.term').length === container.find('.term.term-seen').length\n      }\n\n      container.on('click', '.term-seen-action', function(e) {\n        e.preventDefault();\n\n        var termNode = $(this).parents('.term').first(),\n          termId = termNode.data('termid');\n\n        // TODO Ajax.\n        termNode.addClass('term-loading')\n        Ajax.call([{\n            'methodname': 'mod_wordcards_mark_as_seen',\n            'args': {\n              'termid': termId\n            }\n          }])[0].then(function(result) {\n            if (!result) {\n              return $.Deferred().reject();\n            }\n            termNode.addClass('term-seen');\n          })\n          .fail(Notification.exception)\n          .always(function() {\n            termNode.removeClass('term-loading');\n            if (seenAll()) {\n              btn.prop('disabled', false);\n            }\n          });\n      });\n\n      // Teachers can jump to the next steps.\n      if (!seenAll() && !canmanage) {\n        btn.prop('disabled', true);\n      }\n\n      btn.click(function(e) {\n        e.preventDefault();\n        location.href = $(this).data('href');\n      });\n\n    }\n\n  }\n\n});"],"file":"definitions.min.js"}