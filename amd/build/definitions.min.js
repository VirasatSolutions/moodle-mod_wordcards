define("mod_wordcards/definitions",["jquery","core/ajax","core/notification","core/modal_factory","core/str","core/modal_events","mod_wordcards/a4e"],function(t,e,n,i,r,a,o){"use strict";return{strings:{},init:function(r){var s=this;this.init_strings();var d="#"+r.widgetid,c=t(d).get(0);if(c){var m=JSON.parse(c.value);this.props=m,t(d).remove();var f=t("#definitions-page-"+r.widgetid),g=(m.modid,m.canmanage),l=(m.canattempt,f.find(".definitions-next"));o.register_events(),o.init_audio(m.token,m.region,m.owner),f.on("click",".term-seen-action",function(i){i.preventDefault();var r=t(this).parents(".term").first(),a=r.data("termid");r.addClass("term-loading"),e.call([{methodname:"mod_wordcards_mark_as_seen",args:{termid:a}}])[0].then(function(e){if(!e)return t.Deferred().reject();$('.definition_flashcards [data-termid="'+a+'"]').addClass("term-seen"),$('.definition_grid [data-termid="'+a+'"]').addClass("term-seen")}).fail(n.exception).always(function(){r.removeClass("term-loading"),p()&&l.prop("disabled",!1)})}),p()||g||l.prop("disabled",!0),l.click(function(e){e.preventDefault();var n=t(this).data("href");"reattempt"===t(this).data("action")?i.create({type:i.types.SAVE_CANCEL,title:s.strings.reattempttitle,body:s.strings.reattemptbody}).then(function(t){t.setSaveButtonText(s.strings.reattempt),t.getRoot().on(a.save,function(){window.location.href=n}),t.show()}):window.location.href=n})}else log.debug("No config found on page. Giving up.");function p(){return f.find(".term").length===f.find(".term.term-seen").length}},init_strings:function(){var t=this;r.get_strings([{key:"reattempttitle",component:"mod_wordcards"},{key:"reattemptbody",component:"mod_wordcards"},{key:"reattempt",component:"mod_wordcards"}]).done(function(e){var n=0;t.strings.reattempttitle=e[n++],t.strings.reattemptbody=e[n++],t.strings.reattempt=e[n++]})}}});