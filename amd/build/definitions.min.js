define("mod_wordcards/definitions",["jquery","core/ajax","core/notification","core/modal_factory","core/str","core/modal_events","mod_wordcards/a4e"],function(e,r,t,i,s,a,n){"use strict";return{strings:{},init:function(s){var d=this;this.init_strings();var l="#"+s.widgetid,o=e(l).get(0);if(o){var c=JSON.parse(o.value);this.props=c,e(l).remove();var f=e(".event_flashcards"),m=e(".event_grid");if($(".ProgressBar-step").on("click",function(){if($(this).hasClass("is-current"))return!1;e(".ProgressBar-step").removeClass("is-current").removeClass("is-complete"),e(this).addClass("is-current");var r=$(this).index();if(r>0)for(var t=0;t<=r;t++)e(".ProgressBar").find("li:eq("+t+")").addClass("is-complete");e(".definition_flashcards_ul li").slideUp(300),e(".definition_flashcards_ul").find("li:eq("+r+")").slideDown(300),e(".is-current").removeClass("is-complete"),h(),g()}),window.matchMedia("(max-width: 767px)").matches){var u=e(".definition_flashcards_ul li").length;e(".wrapper_pr").append('<div class="mb_nav"><span class="curr_level_card">1</span> / <span class="tot_level_card">'+u+"</span></div>"),e(".ProgressBar").hide()}e(".definition_flashcards_ul li:gt(0)").hide(),e(".ProgressBar").children("li:first").addClass("is-current"),h(),g(),f.click(function(r){r.preventDefault(),e(".definition_flashcards").show(),e(".definition_grid").hide()}),m.click(function(r){r.preventDefault(),e(".definition_flashcards").hide(),e(".definition_grid").show()}),e("#Next").click(function(){var r=e(".is-current").index()+1;$(".definition_flashcards_ul li").slideUp(300),$(".definition_flashcards_ul li:eq("+r+")").slideDown(300);var t=e(".curr_level_card").html();$(".curr_level_card").html(parseInt(t)+1);var i=e(".ProgressBar");i.children(".is-current").length>0?i.children(".is-current").removeClass("is-current").addClass("is-complete").next().addClass("is-current"):i.children().first().addClass("is-current"),h(),g()}),e("#Prev").click(function(){var r=$(".is-current").index()-1;e(".definition_flashcards_ul li").slideUp(300),e(".definition_flashcards_ul li:eq("+r+")").slideDown(300);var t=e(".curr_level_card").html();e(".curr_level_card").html(parseInt(t)-1);var i=$(".ProgressBar");i.children(".is-current").length>0?i.children(".is-current").removeClass("is-current").prev().removeClass("is-complete").addClass("is-current"):i.children(".is-complete").last().removeClass("is-complete").addClass("is-current"),h(),g()});var _=e("#definitions-page-"+s.widgetid),v=(c.modid,c.canmanage),p=(c.canattempt,_.find(".definitions-next"));n.register_events(),n.init_audio(c.token,c.region,c.owner),_.on("click",".term-seen-action",function(i){i.preventDefault();var s=e(this).parents(".term").first(),a=s.data("termid");s.addClass("term-loading"),r.call([{methodname:"mod_wordcards_mark_as_seen",args:{termid:a}}])[0].then(function(r){if(!r)return e.Deferred().reject();$('.definition_flashcards [data-termid="'+a+'"]').addClass("term-seen"),$('.definition_grid [data-termid="'+a+'"]').addClass("term-seen")}).fail(t.exception).always(function(){s.removeClass("term-loading"),C()&&p.prop("disabled",!1)})}),C()||v||p.prop("disabled",!0),p.click(function(r){r.preventDefault();var t=e(this).data("href");"reattempt"===e(this).data("action")?i.create({type:i.types.SAVE_CANCEL,title:d.strings.reattempttitle,body:d.strings.reattemptbody}).then(function(e){e.setSaveButtonText(d.strings.reattempt),e.getRoot().on(a.save,function(){window.location.href=t}),e.show()}):window.location.href=t})}else log.debug("No config found on page. Giving up.");function h(){if(!0===e(".ProgressBar").children("li:first").hasClass("is-current"))return e("#Prev").attr("disabled","disabled").addClass("add_opacity_level"),!0;e("#Prev").removeAttr("disabled"),e("#Prev").removeAttr("disabled").removeClass("add_opacity_level")}function g(){if(!0===e(".ProgressBar").children("li:last").hasClass("is-current"))return e("#Next").attr("disabled","disabled").addClass("add_opacity_level"),!0;e("#Next").removeAttr("disabled").removeClass("add_opacity_level")}function C(){return _.find(".term").length===_.find(".term.term-seen").length}},init_strings:function(){var e=this;s.get_strings([{key:"reattempttitle",component:"mod_wordcards"},{key:"reattemptbody",component:"mod_wordcards"},{key:"reattempt",component:"mod_wordcards"}]).done(function(r){var t=0;e.strings.reattempttitle=r[t++],e.strings.reattemptbody=r[t++],e.strings.reattempt=r[t++]})}}});