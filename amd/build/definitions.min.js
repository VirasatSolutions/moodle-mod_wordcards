define(["jquery","core/ajax","core/notification","core/modal_factory","core/str","core/modal_events","mod_wordcards/a4e"],function(a,b,c,d,e,f,g){"use strict";return{strings:{},init:function(e){function h(){return m.find(".term").length===m.find(".term.term-seen").length}var i=this;this.init_strings();var j="#"+e.widgetid,k=a(j).get(0);if(!k)return void log.debug("No config found on page. Giving up.");var l=JSON.parse(k.value);this.props=l,a(j).remove();var m=a("#definitions-page-"+e.widgetid),n=(l.modid,l.canmanage),o=(l.canattempt,m.find(".definitions-next"));g.register_events(),g.init_audio(l.token,l.region,l.owner),m.on("click",".term-seen-action",function(d){d.preventDefault();var e=a(this).parents(".term").first(),f=e.data("termid");e.addClass("term-loading"),b.call([{methodname:"mod_wordcards_mark_as_seen",args:{termid:f}}])[0].then(function(b){return b?void e.addClass("term-seen"):a.Deferred().reject()}).fail(c.exception).always(function(){e.removeClass("term-loading"),h()&&o.prop("disabled",!1)})}),h()||n||o.prop("disabled",!0),o.click(function(b){b.preventDefault();var c=a(this).data("href");return"reattempt"!==a(this).data("action")?void(window.location.href=c):void d.create({type:d.types.SAVE_CANCEL,title:i.strings.reattempttitle,body:i.strings.reattemptbody}).then(function(a){a.setSaveButtonText(i.strings.reattempt);var b=a.getRoot();b.on(f.save,function(){window.location.href=c}),a.show()})})},init_strings:function(){var a=this;e.get_strings([{key:"reattempttitle",component:"mod_wordcards"},{key:"reattemptbody",component:"mod_wordcards"},{key:"reattempt",component:"mod_wordcards"}]).done(function(b){var c=0;a.strings.reattempttitle=b[c++],a.strings.reattemptbody=b[c++],a.strings.reattempt=b[c++]})}}});