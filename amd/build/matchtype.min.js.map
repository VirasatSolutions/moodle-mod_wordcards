{"version":3,"sources":["../src/matchtype.js"],"names":["define","$","Ajax","log","a4e","keyboard","templates","app","dryRun","init","props","theid","widgetid","nexturl","configcontrol","get","matchingdata","JSON","parse","value","remove","debug","process","register_events","on","total_time","calc_total_time","results","url","replace","window","location","reload","start","quit","json","terms","has_images","list_vocab","shuffle","pointer","hide","show","text","timer","interval","setInterval","update","count","pretty_print_secs","next","clear","clearInterval","end","tdata","length","calc_total_points","render","then","html","data","activity","console","removeClass","create","disable","check","correct","filter","e","points","incorrect","image","append","alert","selected","toLowerCase","trim","addClass","reportSuccess","reportFailure","result","question","time","push","setTimeout","term1id","term2id","call","methodname","args","termid"],"mappings":"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","sourcesContent":["/**\n * Matching module.\n *\n * @package mod_wordcards\n * @author  Justin Hunt - poodll.com\n * * (based on Paul Raine's APPs 4 EFL)\n */\n\ndefine([\n  'jquery',\n  'core/ajax',\n  'core/log',\n  'mod_wordcards/a4e',\n  'mod_wordcards/keyboard',\n  'core/templates'\n], function($, Ajax, log, a4e, keyboard, templates) {\n\n  var app = {\n    dryRun: false,\n    init: function(props) {\n\n      //pick up opts from html\n      var theid = '#' + props.widgetid;\n      this.dryRun = props.dryRun;\n      this.nexturl = props.nexturl;\n      var configcontrol = $(theid).get(0);\n      if (configcontrol) {\n        var matchingdata = JSON.parse(configcontrol.value);\n        $(theid).remove();\n      } else {\n        //if there is no config we might as well give up\n        log.debug('No config found on page. Giving up.');\n        return;\n      }\n\n      app.process(matchingdata);\n\n      a4e.register_events();\n\n      this.register_events();\n    },\n\n    register_events: function() {\n\n      $('body').on('click', \"#close-results\", function() {\n\n        var total_time = a4e.calc_total_time(app.results);\n        var url = app.nexturl.replace(/&amp;/g, '&') + \"&localscattertime=\" + total_time\n        window.location.replace(url);\n\n      });\n\n      $('body').on('click', \"#try-again\", function() {\n        location.reload();\n      });\n\n      $('body').on('click', '#start-button', function() {\n        app.start();\n      });\n\n      $('body').on('click', '#quit-button', function() {\n        app.quit();\n      });\n    },\n\n    process: function(json) {\n\n      app.terms = json.terms;\n      app.has_images = json.has_images;\n      a4e.list_vocab(\"#vocab-list-inner\", app.terms);\n\n    },\n    start: function() {\n      app.results = [];\n      a4e.shuffle(app.terms);\n      app.pointer = 0;\n      $(\"#vocab-list, #start-button\").hide();\n      $(\"#gameboard, #quit-button\").show();\n      $(\"#time-counter\").text(\"00:00\");\n      app.timer = {\n        interval: setInterval(function() {\n          app.timer.update();\n        }, 1000),\n        count: 0,\n        update: function() {\n          app.timer.count++;\n          $(\"#time-counter\").text(a4e.pretty_print_secs(app.timer.count));\n        }\n      };\n      app.next();\n    },\n    quit: function() {\n      keyboard.clear();\n      clearInterval(app.timer.interval);\n      $(\"#gameboard, #quit-button\").hide();\n      $(\"#vocab-list, #start-button\").show();\n    },\n\n    end: function() {\n      keyboard.clear();\n      clearInterval(app.timer.interval);\n      $(\"#gameboard, #quit-button, #start-button\").hide();\n      $(\"#results\").show();\n\n      //template data\n      var tdata = [];\n      tdata['results'] = app.results;\n      tdata['total'] = app.terms.length;\n      tdata['totalcorrect'] = a4e.calc_total_points(app.results);\n      var total_time = a4e.calc_total_time(app.results);\n      if (total_time == 0) {\n        tdata['prettytime'] = '00:00';\n      } else {\n        tdata['prettytime'] = a4e.pretty_print_secs(total_time);\n      }\n      templates.render('mod_wordcards/feedback', tdata).then(\n        function(html, js) {\n          $(\"#results-inner\").html(html);\n        }\n      );\n\n      var data = {\n        results: app.results,\n        activity: \"match_type\"\n      };\n      console.log(data);\n\n    },\n\n    next: function() {\n\n      $(\"#submitted\").html(\"\").removeClass(\"a4e-correct a4e-incorrect\");\n\n      keyboard.create(\"input\", app.terms[app.pointer]['term'], app.pointer, true, function(value) {\n        $(\"#submitted\").html(app.terms[app.pointer]['term']);\n        keyboard.disable();\n        app.check(value);\n      });\n\n      var progress = {\n        correct: app.results.filter(function(e) {\n          return e.points > 0\n        }).length / app.terms.length * 100,\n        incorrect: app.results.filter(function(e) {\n          return e.points == 0\n        }).length / app.terms.length * 100\n      }\n\n      if (app.terms[app.pointer]['definition'] !== \"\" && app.terms[app.pointer]['term'] !== \"\") {\n        if (app.terms[app.pointer].image !== null && app.terms[app.pointer]['image'] != \"\") {\n          $(\"#question\").html(\"<img style='height:200px;width:auto;' class='center-block img-responsive img-thumbnail' src='\" + app.terms[app.pointer].image + \"'><br/>\");\n        } else if (app.has_images && (app.terms[app.pointer].image == null || app.terms[app.pointer]['term'] == \"\")) {\n          $(\"#question\").html(\"<img style='height:200px;width:auto;' class='center-block img-responsive img-thumbnail' src='/images/no-image.png'><br/>\");\n        }\n        $(\"#question\").append(\"<strong>\" + app.terms[app.pointer]['definition'] + \"</strong>\");\n      } else if (app.terms[app.pointer].image !== null && app.terms[app.pointer].image != \"\") {\n        $(\"#question\").html(\"<img class='center-block img-responsive img-thumbnail' src='\" + app.terms[app.pointer].image + \"'>\");\n      } else {\n        a4e.alert(\"Could not generate a test with these settings!\", \"error\");\n        app.end();\n      }\n\n    },\n\n    check: function(selected) {\n      var correct = selected.toLowerCase().trim() == app.terms[app.pointer]['term'].toLowerCase().trim();\n      var points = 0;\n      if (correct == true) {\n        //createjs.Sound.play('correct');\n        $(\"#submitted\").addClass(\"a4e-correct\");\n        points = 1;\n      } else {\n        $(\"#submitted\").addClass(\"a4e-incorrect\");\n        //createjs.Sound.play('incorrect');\n      }\n\n      //post results to server\n      if (correct) {\n        this.reportSuccess(app.terms[app.pointer]['id']);\n      } else {\n        this.reportFailure(app.terms[app.pointer]['id'], 0);\n      }\n\n      var result = {\n        question: app.terms[app.pointer]['definition'],\n        selected: selected,\n        correct: app.terms[app.pointer]['term'],\n        points: points,\n        time: app.timer.count\n      };\n      app.timer.count = 0;\n      app.results.push(result);\n\n      if (app.pointer < app.terms.length - 1) {\n        app.pointer++;\n\n        setTimeout(function() {\n          app.next();\n        }, 1000)\n\n      } else {\n        app.end();\n      }\n\n\n\n    },\n\n    reportFailure: function(term1id, term2id) {\n      if (this.dryRun) {\n        return;\n      }\n\n      Ajax.call([{\n        methodname: 'mod_wordcards_report_failed_association',\n        args: {\n          term1id: term1id,\n          term2id: term2id\n        }\n      }]);\n    },\n\n    reportSuccess: function(termid) {\n      if (this.dryRun) {\n        return;\n      }\n\n      Ajax.call([{\n        methodname: 'mod_wordcards_report_successful_association',\n        args: {\n          termid: termid\n        }\n      }]);\n    }\n  };\n\n  return app;\n\n});"],"file":"matchtype.min.js"}