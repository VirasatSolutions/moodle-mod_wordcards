define(["jquery","core/ajax"],function(a,b){function c(a){for(var b=a.length-1;b>0;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}var d=function(b,c){this._container=a(b),this._terms=c,this._selected=null};return d.prototype._container=null,d.prototype._dryRun=!1,d.prototype._selected=null,d.prototype._terms=null,d.prototype.init=function(){var b=[];this._terms.forEach(function(a){b.push(this._makeCard(a.id,a.term)),b.push(this._makeCard(a.id,a.definition))}.bind(this)),c(b),b.forEach(function(a){a.hide(),this._container.append(a)}.bind(this)),this._arrangePlayground(),b.forEach(function(a){a.show()}),this._container.on("click",".flashcard",this._handlePick.bind(this)),a(window).on("resize",function(){this._arrangePlayground()}.bind(this))},d.prototype._arrangePlayground=function(){var b=this._container.width(),c=a(window).height(),d=3,e=2*this._terms.length,f=null,g=null,h=0,i=0;e%3>e%2&&(d=2),f=Math.floor(b/d),g=Math.min(Math.round((c-50)/Math.ceil(e/d)),60),this._container.find(".flashcard").each(function(b,c){a(c).css({top:h*g,left:i*f,width:i==d-1?f:f-4,height:g-4}),i++,i>=d&&(i=0,h++)}),this._container.css({height:h*g})},d.prototype._checkComplete=function(){this._container.find(".flashcard.found").length==2*this._terms.length&&this._trigger("complete")},d.prototype._handlePick=function(b){b.preventDefault();var c=a(b.currentTarget);if(!c.hasClass("found")){if(!this._selected)return this._selected=c,void c.addClass("selected");if(!this._selected.is(c)){if(c.data("id")==this._selected.data("id"))this._selected.addClass("found").animate({opacity:0}),c.addClass("found").animate({opacity:0}),this._reportSuccess(this._selected.data("id")),this._checkComplete();else{var d=this._selected;d.addClass("mismatch"),c.addClass("mismatch"),this._reportFailure(this._selected.data("id"),c.data("id")),setTimeout(function(){d.removeClass("mismatch"),c.removeClass("mismatch")},600)}this._selected.removeClass("selected"),this._selected=null}}},d.prototype._makeCard=function(b,c){var d=a('<div class="flashcard">').data("id",b);return d.append(a("<div>").text(c)),d},d.prototype.on=function(a,b){this._container.on(a,b)},d.prototype._reportFailure=function(a,c){this._dryRun||b.call([{methodname:"mod_flashcards_report_failed_association",args:{term1id:a,term2id:c}}])},d.prototype._reportSuccess=function(a){this._dryRun||b.call([{methodname:"mod_flashcards_report_successful_association",args:{termid:a}}])},d.prototype.setDryRun=function(a){this._dryRun=a},d.prototype._trigger=function(a){this._container.trigger(a)},d});