define ("mod_wordcards/dictation",["jquery","core/ajax","core/log","mod_wordcards/a4e","mod_wordcards/keyboard","mod_wordcards/pollyhelper","core/templates"],function(a,b,c,d,e,f,g){var h={dryRun:!1,audio:!1,ttslanguage:"en-US",init:function init(b){var e="#"+b.widgetid;this.dryRun=b.dryRun;this.nexturl=b.nexturl;var g=a(e).get(0);if(g){var i=JSON.parse(g.value);a(e).remove()}else{c.debug("No config found on page. Giving up.");return}f.init(b.token,b.region,b.owner);h.ttslanguage=b.ttslanguage;h.process(i);d.register_events();this.register_events()},register_events:function register_events(){var b=a("#dictation_player");a("body").on("click","#close-results",function(){var a=d.calc_total_time(h.results),b=h.nexturl.replace(/&amp;/g,"&")+"&localscattertime="+a;window.location.replace(b)});a("body").on("click","#try-again",function(){location.reload()});a("#listen-button").click(function(){if(h.audio){b.attr("src",h.audio);b[0].play()}else{f.fetch_polly_url(h.tts,"text",h.ttsvoice)}});f.onnewpollyurl=function(a){b.attr("src",a);b[0].play()};a("body").on("click","#start-button",function(){h.start()});a("body").on("click","#quit-button",function(){h.quit()})},process:function process(a){h.terms=a.terms;h.has_images=a.has_images;d.list_vocab("#vocab-list-inner",h.terms)},start:function start(){h.results=[];d.shuffle(h.terms);h.pointer=0;a("#vocab-list, #start-button").hide();a("#gameboard, #quit-button").show();a("#time-counter").text("00:00");h.timer={interval:setInterval(function(){h.timer.update()},1e3),count:0,update:function update(){h.timer.count++;a("#time-counter").text(d.pretty_print_secs(h.timer.count))}};h.next()},quit:function quit(){e.clear();clearInterval(h.timer.interval);a("#gameboard, #quit-button").hide();a("#vocab-list, #start-button").show()},end:function end(){e.clear();clearInterval(h.timer.interval);a("#gameboard, #quit-button, #start-button").hide();a("#results").show();var b=[];b.results=h.results;b.total=h.terms.length;b.totalcorrect=d.calc_total_points(h.results);var c=d.calc_total_time(h.results);if(0==c){b.prettytime="00:00"}else{b.prettytime=d.pretty_print_secs(c)}g.render("mod_wordcards/feedback",b).then(function(b){a("#results-inner").html(b)});var f={results:h.results,activity:"dictation"};console.log(f)},next:function next(){a("#submitted").html("").removeClass("a4e-correct a4e-incorrect");e.create("input",h.terms[h.pointer].term,h.pointer,!0,function(b){a("#submitted").html(h.terms[h.pointer].term);e.disable();h.check(b)});({correct:100*(h.results.filter(function(a){return 0<a.points}).length/h.terms.length),incorrect:100*(h.results.filter(function(a){return 0==a.points}).length/h.terms.length)});h.tts=h.terms[h.pointer].term;if(h.terms[h.pointer].ttsvoice){h.ttsvoice=h.terms[h.pointer].ttsvoice}else{h.ttsvoice="auto"}if(h.terms[h.pointer].audio){h.audio=h.terms[h.pointer].audio}else{h.audio=!1}a("#listen-button").trigger("click")},check:function check(b){var c=b.toLowerCase().trim()==h.terms[h.pointer].term.toLowerCase().trim(),d=0;if(!0==c){a("#submitted").addClass("a4e-correct");d=1}else{a("#submitted").addClass("a4e-incorrect")}if(c){this.reportSuccess(h.terms[h.pointer].id)}else{this.reportFailure(h.terms[h.pointer].id,0)}var e={question:h.terms[h.pointer].definition,selected:b,correct:h.terms[h.pointer].term,points:d,time:h.timer.count};h.timer.count=0;h.results.push(e);if(h.pointer<h.terms.length-1){h.pointer++;setTimeout(function(){h.next()},1e3)}else{h.end()}},reportFailure:function reportFailure(a,c){if(this.dryRun){return}b.call([{methodname:"mod_wordcards_report_failed_association",args:{term1id:a,term2id:c}}])},reportSuccess:function reportSuccess(a){if(this.dryRun){return}b.call([{methodname:"mod_wordcards_report_successful_association",args:{termid:a}}])}};return h});
//# sourceMappingURL=dictation.min.js.map
