define(["jquery","core/ajax","core/log","mod_wordcards/a4e"],function(a,b,c,d){var e={dryRun:!1,init:function(b){var f="#"+b.widgetid;this.dryRun=b.dryRun;var g=a(f).get(0);if(!g)return void c.debug("No config found on page. Giving up.");var h=JSON.parse(g.value);a(f).remove(),e.process(h),d.register_events(),this.register_events()},register_events:function(){a("#next-button").on("click",function(){e.next()}),a("#close-results").click(function(){a("#results").hide(),a("#start-button, #vocab-list").show()}),a("body").on("click",".a4e-distractor",function(b){e.check(a(this).data("correct"),this)}),a("#start-button").click(function(){e.start()}),a("#quit-button").click(function(){e.quit()})},process:function(a){e.terms=a.terms,e.has_images=a.has_images,d.list_quizlet_vocab("#vocab-list",e.terms)},start:function(){e.results=[],d.shuffle(e.terms),e.pointer=0,a("#vocab-list, #start-button").hide(),a("#gameboard, #quit-button").show(),a("#time-counter").text("00:00"),a("#progress-correct").css("width","0%"),a("#progress-incorrect").css("width","0%"),e.timer={interval:setInterval(function(){e.timer.update()},1e3),count:0,update:function(){e.timer.count++,a("#time-counter").text(d.pretty_print_secs(e.timer.count))}},e.next()},quit:function(){clearInterval(e.timer.interval),a("#gameboard, #quit-button").hide(),a("#vocab-list, #start-button").show()},end:function(){clearInterval(e.timer.interval),a("#gameboard, #quit-button, #start-button").hide(),a("#results").show();var b=d.basic_feedback(e.results);b+=d.detailed_feedback(e.results),a("#results-inner").html(b);var c={results:e.results,activity:"match_select"};console.log(c)},next:function(){a("#next-button").hide(),a("#question-counter").text(e.pointer+1+"/"+e.terms.length);var b={correct:e.results.filter(function(a){return a.points>0}).length/e.terms.length*100,incorrect:e.results.filter(function(a){return 0==a.points}).length/e.terms.length*100};a("#progress-correct").css("width",b.correct+"%"),a("#progress-incorrect").css("width",b.incorrect+"%"),a("#question").html(""),""!==e.terms[e.pointer].definition&&""!==e.terms[e.pointer].term?(null!==e.terms[e.pointer].image?a("#question").html("<img style='height:200px;width:auto;' class='center-block img-responsive img-thumbnail' src='"+e.terms[e.pointer].image.url+"'><br/>"):e.has_images&&null==e.terms[e.pointer].image&&a("#question").html("<img style='height:200px;width:auto;' class='center-block img-responsive img-thumbnail' src='/images/no-image.png'><br/>"),a("#question").append("<strong>"+e.terms[e.pointer].definition+"</strong>")):null!==e.terms[e.pointer].image?a("#question").html("<img class='center-block img-responsive img-thumbnail' src='"+e.terms[e.pointer].image.url+"'>"):(d.alert("Could not generate a test with these settings!","error"),e.end()),a("#input").html(e.get_distractors())},check:function(b,c){var d=0;1==b&&(d=1),a(".a4e-distractor").css("pointer-events","none");var f={question:e.terms[e.pointer].definition,selected:a(c).text(),correct:e.terms[e.pointer].term,points:d,time:e.timer.count};e.timer.count=0,e.results.push(f);var g=1==b?"a4e-correct":"a4e-incorrect";a(c).addClass(g).append("<i style='color:"+(b?"green":"red")+";margin-left:5px;' class='fa fa-"+(b?"check":"times")+"'></i>").parent().addClass("a4e-click-disabled"),b||a(".a4e-distractor[data-correct='true']").addClass("a4e-correct").append("<i style='color:green;margin-left:5px;' class='fa fa-check'></i>"),b?this.reportSuccess(e.terms[e.pointer].id):this.reportFailure(e.terms[e.pointer].id,a(c).data("id")),e.pointer<e.terms.length-1?(e.pointer++,b?setTimeout(function(){a("#next-button").trigger("click")},1e3):a("#next-button").show()):e.end()},get_distractors:function(){var b=e.terms.slice(0),c=e.terms[e.pointer].term;b.splice(e.pointer,1),d.shuffle(b),b=b.slice(0,4),b.push(e.terms[e.pointer]),d.shuffle(b);var f=[];a.each(b,function(a,b){var d=b.term==c,e=b.id;f.push('<li data-id="'+e+'" data-correct="'+d.toString()+'" class="list-group-item a4e-distractor a4e-noselect">'+b.term+"</li>")});var g='<ul class="list-group a4e-distractors">'+f.join("")+"</ul>";return g},reportFailure:function(a,c){this.dryRun||b.call([{methodname:"mod_wordcards_report_failed_association",args:{term1id:a,term2id:c}}])},reportSuccess:function(a){this.dryRun||b.call([{methodname:"mod_wordcards_report_successful_association",args:{termid:a}}])}};return e});