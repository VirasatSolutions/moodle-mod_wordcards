{"version":3,"sources":["../src/speechcards.js"],"names":["define","$","Ajax","log","a4e","glidecards","cloudpoodll","transcriber","templates","app","passmark","pointer","jsondata","props","glider","dryRun","controls","browserspeech","init","theid","widgetid","nexturl","definitionscontrol","get","JSON","parse","value","remove","debug","window","process","register_events","init_audio","token","region","owner","init_controls","close_results","results","vocab_list","the_list","gameboard","time_counter","prev_button","next_button","standalonepushrecorder","do_next","progress_dots","terms","clearStarRating","is_end","go","update_header","do_end","do_prev","html","click","failedword","term","check","on","total_time","timer","count","url","replace","location","reload","start","has_images","list_vocab","initComponents","initCards","getScript","done","setPointer","newpointer","thelist","each","index","card","append","glide","type","autoplay","afterTransition","data","afterInit","theCallback","message","console","action","startAWSTranscriber","stopAWSTranscriber","speechtext","capturedspeech","cleanspeechtext","cleanText","spoken","correct","similarity","wordsDoMatch","showStarRating","flagCorrectAndTransition","checkByPhonetic","then","Deferred","reject","opts","language","parent","appid","expiretime","onFinalResult","transcript","stars","code","forEach","star","setTimeout","active","navigator","mediaDevices","getUserMedia","video","audio","stream","catch","error","closeSocket","call","wordheard","currentterm","alternates","awords","split","matched","i","word","toLowerCase","text","trim","shuffle","hide","show","interval","setInterval","update","pretty_print_secs","quit","clearInterval","tdata","length","calc_total_points","render","activity","filter","e","points","incorrect","spokenwords","css","result","question","selected","push","reportSuccess","reportFailure","term1id","term2id","methodname","args","termid","s1","s2","longer","shorter","longerLength","editDistance","parseFloat","costs","lastValue","j","newValue","charAt","Math","min"],"mappings":"AAQAA,OAAM,6BAAC,CACL,QADK,CAEL,WAFK,CAGL,UAHK,CAIL,mBAJK,CAKL,0BALK,CAML,iCANK,CAOL,gCAPK,CAQL,gBARK,CAAD,CASH,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAuBC,CAAvB,CAA4BC,CAA5B,CAAwCC,CAAxC,CAAqDC,CAArD,CAAkEC,CAAlE,CAA6E,CAE9E,GAAIC,CAAAA,CAAG,CAAG,CACRC,QAAQ,CAAE,EADF,CAERC,OAAO,CAAE,CAFD,CAGRC,QAAQ,CAAE,IAHF,CAIRC,KAAK,CAAE,IAJC,CAKRC,MAAM,CAAE,IALA,CAMRC,MAAM,GANE,CAORC,QAAQ,CAAE,EAPF,CAQRC,aAAa,GARL,CAURC,IAAI,CAAE,cAASL,CAAT,CAAgB,CAGpB,GAAIM,CAAAA,CAAK,CAAG,IAAMN,CAAK,CAACO,QAAxB,CACA,KAAKL,MAAL,CAAcF,CAAK,CAACE,MAApB,CACA,KAAKM,OAAL,CAAeR,CAAK,CAACQ,OAArB,CACA,GAAIC,CAAAA,CAAkB,CAAGrB,CAAC,CAACkB,CAAD,CAAD,CAASI,GAAT,CAAa,CAAb,CAAzB,CACA,GAAID,CAAJ,CAAwB,CACtB,GAAIV,CAAAA,CAAQ,CAAGY,IAAI,CAACC,KAAL,CAAWH,CAAkB,CAACI,KAA9B,CAAf,CACAzB,CAAC,CAACkB,CAAD,CAAD,CAASQ,MAAT,EACD,CAHD,IAGO,CAELxB,CAAG,CAACyB,KAAJ,CAAU,qCAAV,EACA,MACD,CACDnB,CAAG,CAACG,QAAJ,CAAeA,CAAf,CACAH,CAAG,CAACI,KAAJ,CAAYA,CAAZ,CACAJ,CAAG,CAACQ,aAAJ,CAAoB,2BAA6BY,CAAAA,MAA7B,EAAuC,qBAAuBA,CAAAA,MAAlF,CACApB,CAAG,CAACqB,OAAJ,CAAYlB,CAAZ,EAGAR,CAAG,CAAC2B,eAAJ,GACA3B,CAAG,CAAC4B,UAAJ,CAAenB,CAAK,CAACoB,KAArB,CAA2BpB,CAAK,CAACqB,MAAjC,CAAwCrB,CAAK,CAACsB,KAA9C,EAEA,KAAKC,aAAL,GACA,KAAKL,eAAL,EACD,CApCO,CAqCRK,aAAa,CAAE,wBAAW,CACxB3B,CAAG,CAACO,QAAJ,CAAaqB,aAAb,CAA6BpC,CAAC,CAAC,gBAAD,CAA9B,CACAQ,CAAG,CAACO,QAAJ,CAAasB,OAAb,CAAuBrC,CAAC,CAAC,UAAD,CAAxB,CACAQ,CAAG,CAACO,QAAJ,CAAauB,UAAb,CAA0BtC,CAAC,CAAC,aAAD,CAA3B,CACAQ,CAAG,CAACO,QAAJ,CAAawB,QAAb,CAAwBvC,CAAC,CAAC,sBAAD,CAAzB,CACAQ,CAAG,CAACO,QAAJ,CAAayB,SAAb,CAAyBxC,CAAC,CAAC,YAAD,CAA1B,CACAQ,CAAG,CAACO,QAAJ,CAAa0B,YAAb,CAA4BzC,CAAC,CAAC,eAAD,CAA7B,CACAQ,CAAG,CAACO,QAAJ,CAAa2B,WAAb,CAA2B1C,CAAC,CAAC,mCAAD,CAA5B,CACAQ,CAAG,CAACO,QAAJ,CAAa4B,WAAb,CAA2B3C,CAAC,CAAC,mCAAD,CAA5B,CACAQ,CAAG,CAACO,QAAJ,CAAa6B,sBAAb,CAAsC5C,CAAC,CAAC,iCAAD,CACxC,CA/CO,CAgDR6C,OAAO,CAAE,kBAAW,CAClB1C,CAAG,CAAC2C,aAAJ,CAAkBtC,CAAG,CAAC6B,OAAtB,CAA+B7B,CAAG,CAACuC,KAAnC,EACAvC,CAAG,CAACwC,eAAJ,GACA,GAAI,CAACxC,CAAG,CAACyC,MAAJ,EAAL,CAAmB,CACjBzC,CAAG,CAACK,MAAJ,CAAWqC,EAAX,CAAc,GAAd,EACA1C,CAAG,CAAC2C,aAAJ,EACD,CAHD,IAGO,CACL3C,CAAG,CAAC4C,MAAJ,EACD,CACF,CAzDO,CA0DRC,OAAO,CAAE,kBAAW,CAClB7C,CAAG,CAACK,MAAJ,CAAWqC,EAAX,CAAc,GAAd,EACA1C,CAAG,CAAC2C,aAAJ,EACD,CA7DO,CA+DRH,eAAe,CAAC,0BAAU,CACxBhD,CAAC,CAAC,cAAD,CAAD,CAAkBsD,IAAlB,CAAuB,gBAAvB,CACD,CAjEO,CAmERxB,eAAe,CAAE,0BAAW,CAE1BtB,CAAG,CAACO,QAAJ,CAAa2B,WAAb,CAAyBa,KAAzB,CAA+B,UAAW,CACxC/C,CAAG,CAAC6C,OAAJ,EACD,CAFD,EAGA7C,CAAG,CAACO,QAAJ,CAAa4B,WAAb,CAAyBY,KAAzB,CAA+B,UAAW,CAGxC,GAAIC,CAAAA,CAAU,CAAGhD,CAAG,CAACuC,KAAJ,CAAUvC,CAAG,CAACE,OAAJ,CAAc,CAAxB,EAA2B+C,IAA5C,CACAjD,CAAG,CAACkD,KAAJ,IAAiBF,CAAjB,EACAhD,CAAG,CAACqC,OAAJ,EAED,CAPD,EASA7C,CAAC,CAAC,MAAD,CAAD,CAAU2D,EAAV,CAAa,OAAb,CAAsB,gBAAtB,CAAwC,UAAW,IAE7CC,CAAAA,CAAU,CAAGpD,CAAG,CAACqD,KAAJ,CAAUC,KAFsB,CAG7CC,CAAG,CAAGvD,CAAG,CAACY,OAAJ,CAAY4C,OAAZ,CAAoB,QAApB,CAA8B,GAA9B,EAAqC,oBAArC,CAA4DJ,CAHrB,CAIjDhC,MAAM,CAACqC,QAAP,CAAgBD,OAAhB,CAAwBD,CAAxB,CAED,CAND,EAQA/D,CAAC,CAAC,MAAD,CAAD,CAAU2D,EAAV,CAAa,OAAb,CAAsB,YAAtB,CAAoC,UAAW,CAC7CM,QAAQ,CAACC,MAAT,EACD,CAFD,EAIAlE,CAAC,CAAC,MAAD,CAAD,CAAU2D,EAAV,CAAa,OAAb,CAAsB,eAAtB,CAAuC,UAAW,CAChDnD,CAAG,CAAC2D,KAAJ,EACD,CAFD,CAID,CAjGO,CAmGRtC,OAAO,CAAE,iBAASlB,CAAT,CAAmB,CAE1BH,CAAG,CAACuC,KAAJ,CAAYpC,CAAQ,CAACoC,KAArB,CACAvC,CAAG,CAAC4D,UAAJ,CAAiBzD,CAAQ,CAACyD,UAA1B,CACAjE,CAAG,CAACkE,UAAJ,CAAe,mBAAf,CAAoC7D,CAAG,CAACuC,KAAxC,EAGA,KAAKuB,cAAL,EAED,CA5GO,CA8GRC,SAAS,CAAE,oBAAW,CACpBvE,CAAC,CAACwE,SAAF,CAAY,8DAAZ,EAA4EC,IAA5E,CAAiF,UAAW,CAE1F,QAASC,CAAAA,CAAT,CAAoBC,CAApB,CAAgC,CAC9BnE,CAAG,CAACE,OAAJ,CAAciE,CACf,CAJyF,GAQtFC,CAAAA,CAAO,CAAGpE,CAAG,CAACO,QAAJ,CAAawB,QAR+D,CAU1FvC,CAAC,CAAC6E,IAAF,CAAOrE,CAAG,CAACG,QAAJ,CAAaoC,KAApB,CAA2B,SAAS+B,CAAT,CAAgBC,CAAhB,CAAsB,CAC/CH,CAAO,CAACI,MAAR,CAAe,6FAAYhB,OAAZ,CAAoB,WAApB,CAAiCe,CAAI,CAACtB,IAAtC,CAAf,CACD,CAFD,EAIAjD,CAAG,CAACK,MAAJ,CAAab,CAAC,CAAC,oBAAD,CAAD,CAAwBiF,KAAxB,CAA8B,CACzCC,IAAI,CAAE,UADmC,CAEzCC,QAAQ,GAFiC,CAGzCC,eAAe,CAAE,yBAASC,CAAT,CAAe,CAC9BX,CAAU,CAACW,CAAI,CAACP,KAAN,CAAV,CACAtE,CAAG,CAAC2C,aAAJ,EACD,CANwC,CAOzCmC,SAAS,CAAE,mBAASD,CAAT,CAAe,CACxBX,CAAU,CAACW,CAAI,CAACP,KAAN,CACX,CATwC,CAA9B,EAUVO,IAVU,CAUL,WAVK,CAWd,CAzBD,CA0BD,CAzIO,CA2IRf,cAAc,CAAE,yBAAW,CAIzB,GAAIiB,CAAAA,CAAW,CAAG,SAASC,CAAT,CAAkB,CAClCC,OAAO,CAACvF,GAAR,CAAY,oBAAZ,EAEA,OAAQsF,CAAO,CAACN,IAAhB,EACE,IAAK,WAAL,CAGE,GAAI1E,CAAG,CAACQ,aAAR,CAAuB,CACrB,MACD,CAGD,GAAsB,SAAlB,EAAAwE,CAAO,CAACE,MAAZ,CAAiC,CAC/BlF,CAAG,CAACmF,mBAAJ,EACD,CAFD,IAEO,IAAsB,SAAlB,EAAAH,CAAO,CAACE,MAAZ,CAAiC,CACtClF,CAAG,CAACoF,kBAAJ,EACD,CACD,MAEF,IAAK,QAAL,IACMC,CAAAA,CAAU,CAAGL,CAAO,CAACM,cAD3B,CAEMC,CAAe,CAAGvF,CAAG,CAACwF,SAAJ,CAAcH,CAAd,CAFxB,CAIMI,CAAM,CAAGF,CAJf,CAKMG,CAAO,CAAG1F,CAAG,CAACuC,KAAJ,CAAUvC,CAAG,CAACE,OAAJ,CAAc,CAAxB,EAA2B+C,IAL3C,CAQM0C,CAAU,CAAG3F,CAAG,CAAC2F,UAAJ,CAAeF,CAAf,CAAsBC,CAAtB,CARnB,CASEhG,CAAG,CAACyB,KAAJ,CAAU,kBAAoBsE,CAApB,CAA6B,GAA7B,CAAmCC,CAAnC,CAA4C,GAA5C,CAAkDC,CAA5D,EAGA,GAAIA,CAAU,EAAI3F,CAAG,CAACC,QAAlB,EACAD,CAAG,CAAC4F,YAAJ,CAAiBL,CAAjB,CAAkCvF,CAAG,CAACuC,KAAJ,CAAUvC,CAAG,CAACE,OAAJ,CAAc,CAAxB,CAAlC,CADJ,CACoE,CAChER,CAAG,CAACyB,KAAJ,CAAU,gBAAuBsE,CAAvB,CAA+B,GAA/B,CAAqCC,CAA/C,EACE1F,CAAG,CAAC6F,cAAJ,CAAmB,GAAnB,EACA7F,CAAG,CAAC8F,wBAAJ,CAA6B9F,CAAG,CAACuC,KAAJ,CAAUvC,CAAG,CAACE,OAAJ,CAAc,CAAxB,CAA7B,EACA,MACL,CAGDF,CAAG,CAAC+F,eAAJ,CAAoBN,CAApB,CAA2BC,CAA3B,EAAoCM,IAApC,CAAyC,SAASL,CAAT,CAAqB,CAC5D,GAAI,KAAAA,CAAJ,CAAwB,CACpB,MAAOnG,CAAAA,CAAC,CAACyG,QAAF,GAAaC,MAAb,EACV,CAFD,IAEK,CACDxG,CAAG,CAACyB,KAAJ,CAAU,mBAAqBsE,CAArB,CAA8B,GAA9B,CAAoCC,CAApC,CAA6C,GAA7C,CAAmDC,CAA7D,EACA3F,CAAG,CAAC6F,cAAJ,CAAmBF,CAAnB,EACA,GAAGA,CAAU,EAAE3F,CAAG,CAACC,QAAnB,CAA6B,CACzBD,CAAG,CAAC8F,wBAAJ,CAA6BH,CAA7B,CAAyC3F,CAAG,CAACuC,KAAJ,CAAUvC,CAAG,CAACE,OAAJ,CAAc,CAAxB,CAAzC,CACH,CACJ,CACD,CAVF,EArCJ,CAkDD,CArDD,CAwDAL,CAAW,CAACY,IAAZ,CAAiB,0BAAjB,CAA6CsE,CAA7C,EAGA,GAAIoB,CAAAA,CAAI,CAAG,UACQnG,CAAG,CAACI,KAAJ,CAAUgG,QADlB,QAEMpG,CAAG,CAACI,KAAJ,CAAUqB,MAFhB,OAKKzB,CAAG,CAACI,KAAJ,CAAUoB,KALf,QAMMxB,CAAG,CAACI,KAAJ,CAAUiG,MANhB,OAOKrG,CAAG,CAACI,KAAJ,CAAUsB,KAPf,OAQK1B,CAAG,CAACI,KAAJ,CAAUkG,KARf,YASUtG,CAAG,CAACI,KAAJ,CAAUmG,UATpB,CAAX,CAWAzG,CAAW,CAACW,IAAZ,CAAiB0F,CAAjB,EACArG,CAAW,CAAC0G,aAAZ,CAA4B,SAASC,CAAT,CAA6B,CAKvD1B,CAAW,CAJG,CACZL,IAAI,CAAE,QADM,CAGNY,cAHM,CAGWmB,CAHX,CAIH,CACZ,CACF,CA7NO,CA+NRZ,cA/NQ,yBA+NOF,CA/NP,CA+NkB,CAEtB,GAAIe,CAAAA,CAAK,CAAG,UAAZ,CACA,GAAc,CAAX,CAAAf,CAAH,CAAgB,CACZe,CAAK,CAAC,UACT,CACD,GAAGf,CAAU,CAAC3F,CAAG,CAACC,QAAlB,CAA2B,CACvByG,CAAK,CAAC,UACT,CACD,GAAc,EAAX,CAAAf,CAAH,CAAkB,CACde,CAAK,CAAC,UACT,CACDzB,OAAO,CAACvF,GAAR,CAAYgH,CAAZ,CAAkBf,CAAlB,EAGA,GAAIgB,CAAAA,CAAI,CAAC,EAAT,CACAD,CAAK,CAACE,OAAN,CAAc,SAASC,CAAT,CAAc,CACxB,GAAG,KAAAA,CAAH,CAAe,CACXF,CAAI,EAAE,8BACT,CAFD,IAGI,CACAA,CAAI,EAAE,gCACT,CACJ,CAPD,EAQA1B,OAAO,CAACvF,GAAR,CAAYiH,CAAZ,EACAnH,CAAC,CAAC,cAAD,CAAD,CAAkBsD,IAAlB,CAAuB6D,CAAvB,CACH,CAzPO,CA2PRb,wBAAwB,CAAE,kCAAS7C,CAAT,CAAc,CAGpCjD,CAAG,CAACkD,KAAJ,IAAgBD,CAAhB,EAGA,GAAIjD,CAAG,CAACyC,MAAJ,EAAJ,CAAkB,CACdzC,CAAG,CAAC2C,aAAJ,GACAmE,UAAU,CAAC,UAAW,CAClB9G,CAAG,CAAC4C,MAAJ,EACH,CAFS,CAEP,GAFO,CAGb,CALD,IAKO,CACHkE,UAAU,CAAC,UAAW,CAClB9G,CAAG,CAACqC,OAAJ,EACH,CAFS,CAEP,GAFO,CAGb,CAEJ,CA5QO,CA8QR8C,mBAAmB,CAAE,8BAAW,CAC9B,GAAIrF,CAAW,CAACiH,MAAhB,CAAwB,CACtB,MACD,CAED3F,MAAM,CAAC4F,SAAP,CAAiBC,YAAjB,CAA8BC,YAA9B,CAA2C,CACzCC,KAAK,GADoC,CAEzCC,KAAK,GAFoC,CAA3C,EAGGpB,IAHH,CAGQ,SAASqB,CAAT,CAAiB,CACvBvH,CAAW,CAAC6D,KAAZ,CAAkB0D,CAAlB,CAA0BvH,CAA1B,CACD,CALD,EAKGwH,KALH,CAKS,SAASC,CAAT,CAAgB,CACvB7H,CAAG,CAACyB,KAAJ,CAAUoG,CAAV,EACA7H,CAAG,CAACyB,KAAJ,CAAU,iFAAV,CACD,CARD,CASD,CA5RO,CA8RRiE,kBAAkB,CAAE,6BAAW,CAC7B,GAAI,CAACtF,CAAW,CAACiH,MAAjB,CAAyB,CACvB,MACD,CACDjH,CAAW,CAAC0H,WAAZ,EACD,CAnSO,CAsSRzB,eAAe,CAAE,yBAASN,CAAT,CAAiBC,CAAjB,CAAyB,CAExC,MAAOjG,CAAAA,CAAI,CAACgI,IAAL,CAAU,CAAC,CACZ,WAAc,iCADF,CAEZ,KAAQ,CACJ,OAAUhC,CADN,CAEJ,QAAWC,CAFP,CAGJ,SAAY1F,CAAG,CAACI,KAAJ,CAAUgG,QAHlB,CAFI,CAAD,CAAV,EAOD,CAPC,CASR,CAjTO,CAmTRR,YAAY,CAAE,sBAAS8B,CAAT,CAAoBC,CAApB,CAAiC,CAE5CD,CAAS,CAAG1H,CAAG,CAACwF,SAAJ,CAAckC,CAAd,CAAZ,CACDC,CAAW,CAAC1E,IAAZ,CAAmBjD,CAAG,CAACwF,SAAJ,CAAcmC,CAAW,CAAC1E,IAA1B,CAAnB,CACA,GAAIyE,CAAS,EAAIC,CAAW,CAAC1E,IAA7B,CAAmC,CACjC,QACD,CACD,GAAI,CAAC0E,CAAW,CAACC,UAAjB,CAA6B,CAC3B,QACD,CAT4C,GAUzCC,CAAAA,CAAM,CAAGF,CAAW,CAACC,UAAZ,CAAuBE,KAAvB,CAA6B,GAA7B,CAVgC,CAWzCC,CAAO,GAXkC,CAY7CvI,CAAC,CAAC6E,IAAF,CAAOwD,CAAP,CAAe,SAASG,CAAT,CAAYC,CAAZ,CAAkB,CAC/B,GAAIjI,CAAG,CAACwF,SAAJ,CAAcyC,CAAI,CAACC,WAAL,EAAd,GAAqCR,CAAzC,CAAoD,CAElDK,CAAO,GAAP,CACA,QACD,CACF,CAND,EAOA,MAAOA,CAAAA,CACR,CAvUO,CAyURvC,SAAS,CAAE,mBAAS2C,CAAT,CAAe,CACxB,MAAOA,CAAAA,CAAI,CAACD,WAAL,GAAmB1E,OAAnB,CAA2B,YAA3B,CAAyC,EAAzC,EAA6CA,OAA7C,CAAqD,MAArD,CAA6D,GAA7D,EAAkE4E,IAAlE,EACR,CA3UO,CA6URzE,KAAK,CAAE,gBAAW,CAChB3D,CAAG,CAAC6B,OAAJ,CAAc,EAAd,CACAlC,CAAG,CAAC0I,OAAJ,CAAYrI,CAAG,CAACuC,KAAhB,EACAvC,CAAG,CAACO,QAAJ,CAAauB,UAAb,CAAwBwG,IAAxB,GACAtI,CAAG,CAACO,QAAJ,CAAayB,SAAb,CAAuBuG,IAAvB,GACAvI,CAAG,CAACO,QAAJ,CAAa0B,YAAb,CAA0BkG,IAA1B,CAA+B,OAA/B,EACAnI,CAAG,CAACwC,eAAJ,GACA7C,CAAG,CAAC2C,aAAJ,CAAkBtC,CAAG,CAAC6B,OAAtB,CAA+B7B,CAAG,CAACuC,KAAnC,EACAvC,CAAG,CAACqD,KAAJ,CAAY,CACVmF,QAAQ,CAAEC,WAAW,CAAC,UAAW,CAC/BzI,CAAG,CAACqD,KAAJ,CAAUqF,MAAV,EACD,CAFoB,CAElB,GAFkB,CADX,CAIVpF,KAAK,CAAE,CAJG,CAKVoF,MAAM,CAAE,iBAAW,CACjB1I,CAAG,CAACqD,KAAJ,CAAUC,KAAV,GACAtD,CAAG,CAACO,QAAJ,CAAa0B,YAAb,CAA0BkG,IAA1B,CAA+BxI,CAAG,CAACgJ,iBAAJ,CAAsB3I,CAAG,CAACqD,KAAJ,CAAUC,KAAhC,CAA/B,CACD,CARS,CAAZ,CAUAtD,CAAG,CAAC2C,aAAJ,GACA,KAAKoB,SAAL,EACD,CAjWO,CAkWR6E,IAAI,CAAE,eAAW,CACfC,aAAa,CAAC7I,CAAG,CAACqD,KAAJ,CAAUmF,QAAX,CAAb,CACAxI,CAAG,CAACO,QAAJ,CAAayB,SAAb,CAAuBsG,IAAvB,GACAtI,CAAG,CAACO,QAAJ,CAAauB,UAAb,CAAwByG,IAAxB,EACD,CAtWO,CAwWR3F,MAAM,CAAE,iBAAW,CACjBiG,aAAa,CAAC7I,CAAG,CAACqD,KAAJ,CAAUmF,QAAX,CAAb,CACAhJ,CAAC,CAAC,yCAAD,CAAD,CAA6C8I,IAA7C,GACA9I,CAAC,CAAC,UAAD,CAAD,CAAc+I,IAAd,GAGA,GAAIO,CAAAA,CAAK,CAAG,EAAZ,CACAA,CAAK,QAAL,CAAmB9I,CAAG,CAAC6B,OAAvB,CACAiH,CAAK,MAAL,CAAiB9I,CAAG,CAACuC,KAAJ,CAAUwG,MAA3B,CACAD,CAAK,aAAL,CAAwBnJ,CAAG,CAACqJ,iBAAJ,CAAsBhJ,CAAG,CAAC6B,OAA1B,CAAxB,CACA,GAAIuB,CAAAA,CAAU,CAAGpD,CAAG,CAACqD,KAAJ,CAAUC,KAA3B,CACA,GAAkB,CAAd,EAAAF,CAAJ,CAAqB,CACnB0F,CAAK,WAAL,CAAsB,OACvB,CAFD,IAEO,CACLA,CAAK,WAAL,CAAsBnJ,CAAG,CAACgJ,iBAAJ,CAAsBvF,CAAtB,CACvB,CACDrD,CAAS,CAACkJ,MAAV,CAAiB,wBAAjB,CAA2CH,CAA3C,EAAkD9C,IAAlD,CACE,SAASlD,CAAT,CAAmB,CACjBtD,CAAC,CAAC,gBAAD,CAAD,CAAoBsD,IAApB,CAAyBA,CAAzB,CACD,CAHH,EAMA,GAAI+B,CAAAA,CAAI,CAAG,CACThD,OAAO,CAAE7B,CAAG,CAAC6B,OADJ,CAETqH,QAAQ,CAAE,aAFD,CAAX,CAIAjE,OAAO,CAACvF,GAAR,CAAYmF,CAAZ,CACD,CAnYO,CAqYRpC,MAAM,CAAE,iBAAW,CACjB,GAAIzC,CAAG,CAACE,OAAJ,CAAcF,CAAG,CAACuC,KAAJ,CAAUwG,MAA5B,CAAoC,CAClC,QACD,CAFD,IAEO,CACL,QACD,CACF,CA3YO,CA6YRpG,aAAa,CAAE,wBAAW,EAET,CACb+C,OAAO,CAEwB,GAFtB,EAAA1F,CAAG,CAAC6B,OAAJ,CAAYsH,MAAZ,CAAmB,SAASC,CAAT,CAAY,CACtC,MAAkB,EAAX,CAAAA,CAAC,CAACC,MACV,CAFQ,EAENN,MAFM,CAEG/I,CAAG,CAACuC,KAAJ,CAAUwG,MAFb,CADI,CAIbO,SAAS,CAEsB,GAFpB,EAAAtJ,CAAG,CAAC6B,OAAJ,CAAYsH,MAAZ,CAAmB,SAASC,CAAT,CAAY,CACxC,MAAmB,EAAZ,EAAAA,CAAC,CAACC,MACV,CAFU,EAERN,MAFQ,CAEC/I,CAAG,CAACuC,KAAJ,CAAUwG,MAFX,CAJE,CAFS,CAWzB,CAxZO,CA0ZR7F,KAAK,CAAE,eAASwC,CAAT,CAAkB6D,CAAlB,CAA+B,CACpC,GAAIF,CAAAA,CAAM,CAAG,CAAb,CACA,GAAI,IAAA3D,CAAJ,CAAqB,CAEnB2D,CAAM,CAAG,CACV,CAHD,IAGO,CACLA,CAAM,CAAG,CAEV,CACD7J,CAAC,CAAC,iBAAD,CAAD,CAAqBgK,GAArB,CAAyB,gBAAzB,CAA2C,MAA3C,EACA,GAAIC,CAAAA,CAAM,CAAG,CACXvJ,OAAO,CAAEF,CAAG,CAACE,OADF,CAEXwJ,QAAQ,CAAE1J,CAAG,CAACuC,KAAJ,CAAUvC,CAAG,CAACE,OAAJ,CAAc,CAAxB,YAFC,CAGXyJ,QAAQ,CAAEJ,CAHC,CAIX7D,OAAO,CAAE1F,CAAG,CAACuC,KAAJ,CAAUvC,CAAG,CAACE,OAAJ,CAAc,CAAxB,MAJE,CAKXmJ,MAAM,CAAEA,CALG,CAAb,CAQA7J,CAAC,CAAC6E,IAAF,CAAOrE,CAAG,CAAC6B,OAAX,CAAqB,SAAS4H,CAAT,CAAiB,CACpC,GAAIzJ,CAAG,CAACE,OAAJ,GAAgBuJ,CAAM,CAACvJ,OAA3B,CAAoC,CAEnC,CACF,CAJD,EAMAF,CAAG,CAAC6B,OAAJ,CAAY+H,IAAZ,CAAiBH,CAAjB,EAGA,GAAI/D,CAAJ,CAAa,CACX,KAAKmE,aAAL,CAAmB7J,CAAG,CAACuC,KAAJ,CAAUvC,CAAG,CAACE,OAAJ,CAAc,CAAxB,IAAnB,CACD,CAFD,IAEO,CACL,KAAK4J,aAAL,CAAmB9J,CAAG,CAACuC,KAAJ,CAAUvC,CAAG,CAACE,OAAJ,CAAc,CAAxB,IAAnB,CAAqD,CAAC,CAAtD,CACD,CAEF,CA3bO,CA6bR4J,aAAa,CAAE,uBAASC,CAAT,CAAkBC,CAAlB,CAA2B,CACxC,GAAI,KAAK1J,MAAT,CAAiB,CACf,MACD,CAEDb,CAAI,CAACgI,IAAL,CAAU,CAAC,CACTwC,UAAU,CAAE,yCADH,CAETC,IAAI,CAAE,CACJH,OAAO,CAAEA,CADL,CAEJC,OAAO,CAAEA,CAFL,CAFG,CAAD,CAAV,CAOD,CAzcO,CA2cRH,aAAa,CAAE,uBAASM,CAAT,CAAiB,CAC9B,GAAI,KAAK7J,MAAT,CAAiB,CACf,MACD,CAEDb,CAAI,CAACgI,IAAL,CAAU,CAAC,CACTwC,UAAU,CAAE,6CADH,CAETC,IAAI,CAAE,CACJC,MAAM,CAAEA,CADJ,CAFG,CAAD,CAAV,CAMD,CAtdO,CAwdRxE,UAAU,CAAE,oBAASyE,CAAT,CAAaC,CAAb,CAAiB,IACvBC,CAAAA,CAAM,CAAGF,CADc,CAEvBG,CAAO,CAAGF,CAFa,CAG3B,GAAID,CAAE,CAACrB,MAAH,CAAYsB,CAAE,CAACtB,MAAnB,CAA2B,CACzBuB,CAAM,CAAGD,CAAT,CACAE,CAAO,CAAGH,CACX,CACD,GAAII,CAAAA,CAAY,CAAGF,CAAM,CAACvB,MAA1B,CACA,GAAoB,CAAhB,EAAAyB,CAAJ,CAAuB,CACrB,MAAO,EACR,CACD,MAAO,CAACA,CAAY,CAAGxK,CAAG,CAACyK,YAAJ,CAAiBH,CAAjB,CAAyBC,CAAzB,CAAhB,EAAqDG,UAAU,CAACF,CAAD,CACvE,CApeO,CAqeRC,YAAY,CAAE,sBAASL,CAAT,CAAaC,CAAb,CAAiB,CAC7BD,CAAE,CAAGA,CAAE,CAAClC,WAAH,EAAL,CACAmC,CAAE,CAAGA,CAAE,CAACnC,WAAH,EAAL,CAGA,OADIyC,CAAAA,CAAK,GACT,CAAS3C,CAAC,CAAG,CAAb,CACM4C,CADN,CAAgB5C,CAAC,EAAIoC,CAAE,CAACrB,MAAxB,CAAgCf,CAAC,EAAjC,CAAqC,CAC/B4C,CAD+B,CACnB5C,CADmB,CAEnC,IAAK,GAAI6C,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,EAAIR,CAAE,CAACtB,MAAxB,CAAgC8B,CAAC,EAAjC,CAAqC,CACnC,GAAS,CAAL,EAAA7C,CAAJ,CACE2C,CAAK,CAACE,CAAD,CAAL,CAAWA,CAAX,CADF,IAEK,CACH,GAAQ,CAAJ,CAAAA,CAAJ,CAAW,CACT,GAAIC,CAAAA,CAAQ,CAAGH,CAAK,CAACE,CAAC,CAAG,CAAL,CAApB,CACA,GAAIT,CAAE,CAACW,MAAH,CAAU/C,CAAC,CAAG,CAAd,GAAoBqC,CAAE,CAACU,MAAH,CAAUF,CAAC,CAAG,CAAd,CAAxB,CACEC,CAAQ,CAAGE,IAAI,CAACC,GAAL,CAASD,IAAI,CAACC,GAAL,CAASH,CAAT,CAAmBF,CAAnB,CAAT,CACTD,CAAK,CAACE,CAAD,CADI,EACG,CADd,CAEFF,CAAK,CAACE,CAAC,CAAG,CAAL,CAAL,CAAeD,CAAf,CACAA,CAAS,CAAGE,CACb,CACF,CACF,CACD,GAAQ,CAAJ,CAAA9C,CAAJ,CACE2C,CAAK,CAACN,CAAE,CAACtB,MAAJ,CAAL,CAAmB6B,CACtB,CACD,MAAOD,CAAAA,CAAK,CAACN,CAAE,CAACtB,MAAJ,CACb,CA9fO,CAAV,CAkgBA,MAAO/I,CAAAA,CAER,CA/gBK,CAAN","sourcesContent":["/**\n * Matching module.\n *\n * @package mod_wordcards\n * @author  Justin Hunt - poodll.com\n * * (based on Paul Raine's APPs 4 EFL)\n */\n\ndefine([\n  'jquery',\n  'core/ajax',\n  'core/log',\n  'mod_wordcards/a4e',\n  'mod_wordcards/glidecards',\n  'mod_wordcards/cloudpoodllloader',\n  'mod_wordcards/transcriber-lazy',\n  'core/templates'\n], function($, Ajax, log, a4e, glidecards, cloudpoodll, transcriber, templates) {\n\n  var app = {\n    passmark: 75,\n    pointer: 1,\n    jsondata: null,\n    props: null,\n    glider: null,\n    dryRun: false,\n    controls: {},\n    browserspeech: false,\n\n    init: function(props) {\n\n      //pick up opts from html\n      var theid = '#' + props.widgetid;\n      this.dryRun = props.dryRun;\n      this.nexturl = props.nexturl;\n      var definitionscontrol = $(theid).get(0);\n      if (definitionscontrol) {\n        var jsondata = JSON.parse(definitionscontrol.value);\n        $(theid).remove();\n      } else {\n        //if there is no config we might as well give up\n        log.debug('No config found on page. Giving up.');\n        return;\n      }\n      app.jsondata = jsondata;\n      app.props = props;\n      app.browserspeech = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;\n      app.process(jsondata);\n\n\n      a4e.register_events();\n      a4e.init_audio(props.token,props.region,props.owner);\n\n      this.init_controls();\n      this.register_events();\n    },\n    init_controls: function() {\n      app.controls.close_results = $(\"#close-results\");\n      app.controls.results = $(\"#results\");\n      app.controls.vocab_list = $(\"#vocab-list\");\n      app.controls.the_list = $(\"#speechcards_thelist\");\n      app.controls.gameboard = $(\"#gameboard\");\n      app.controls.time_counter = $(\"#time-counter\");\n      app.controls.prev_button = $(\".wordcards-speechcards_prevbutton\");\n      app.controls.next_button = $(\".wordcards-speechcards_nextbutton\");\n      app.controls.standalonepushrecorder = $(\".speechcards_standalonerecorder\");\n    },\n    do_next: function() {\n      a4e.progress_dots(app.results, app.terms);\n      app.clearStarRating();\n      if (!app.is_end()) {\n        app.glider.go('>');\n        app.update_header();\n      } else {\n        app.do_end();\n      }\n    },\n    do_prev: function() {\n      app.glider.go('<');\n      app.update_header();\n    },\n\n    clearStarRating:function(){\n      $(\"#star-rating\").html('· · ·');\n    },\n    \n    register_events: function() {\n\n      app.controls.prev_button.click(function() {\n        app.do_prev();\n      });\n      app.controls.next_button.click(function() {\n\n        //user has given up tryint pronounce it,update word as failed\n        var failedword = app.terms[app.pointer - 1].term;\n        app.check(false, failedword);\n        app.do_next();\n\n      });\n\n      $('body').on('click', \"#close-results\", function() {\n\n        var total_time = app.timer.count;\n        var url = app.nexturl.replace(/&amp;/g, '&') + \"&localscattertime=\" + total_time\n        window.location.replace(url);\n\n      });\n\n      $('body').on('click', \"#try-again\", function() {\n        location.reload();\n      });\n\n      $('body').on('click', '#start-button', function() {\n        app.start();\n      });\n\n    },\n\n    process: function(jsondata) {\n\n      app.terms = jsondata.terms;\n      app.has_images = jsondata.has_images;\n      a4e.list_vocab(\"#vocab-list-inner\", app.terms);\n\n      //init components\n      this.initComponents();\n\n    },\n\n    initCards: function() {\n      $.getScript('https://cdn.jsdelivr.net/npm/glidejs@2.1.0/dist/glide.min.js').done(function() {\n\n        function setPointer(newpointer) {\n          app.pointer = newpointer;\n        }\n\n        //add speechcards\n        var li_template = \"<li class='glide__slide'><div class='wordcards-poodllspeechcards_box'>@thetext@</div></li>\";\n        var thelist = app.controls.the_list;\n\n        $.each(app.jsondata.terms, function(index, card) {\n          thelist.append(li_template.replace('@thetext@', card.term))\n        });\n\n        app.glider = $(\"#speechcards_glide\").glide({\n          type: \"carousel\",\n          autoplay: false,\n          afterTransition: function(data) {\n            setPointer(data.index);\n            app.update_header();\n          },\n          afterInit: function(data) {\n            setPointer(data.index);\n          },\n        }).data('glide_api');\n      });\n    },\n\n    initComponents: function() {\n\n      //The logic here is that on correct we transition.\n      //on incorrect we do not. A subsequent nav button click then doesnt need to post a result\n      var theCallback = function(message) {\n        console.log(\"triggered callback\");\n        //console.log(message);\n        switch (message.type) {\n          case 'recording':\n\n            //we only use AWS transcription is browserspeech is not available\n            if (app.browserspeech) {\n              return;\n            }\n\n            //if using AWS transcriber\n            if (message.action == 'started') {\n              app.startAWSTranscriber();\n            } else if (message.action == 'stopped') {\n              app.stopAWSTranscriber();\n            }\n            break;\n\n          case 'speech':\n            var speechtext = message.capturedspeech;\n            var cleanspeechtext = app.cleanText(speechtext);\n            \n            var spoken = cleanspeechtext;\n            var correct = app.terms[app.pointer - 1].term;\n\n            //Similarity check by character matching\n            var similarity = app.similarity(spoken,correct);\n            log.debug('JS similarity: ' + spoken + ':' + correct +':' + similarity);\n\n            //Similarity check by direct-match/acceptable-mistranscription\n            if (similarity >= app.passmark ||\n                app.wordsDoMatch(cleanspeechtext, app.terms[app.pointer - 1]) ) {\n                log.debug('local match:' + ':' + spoken +':' + correct);\n                  app.showStarRating(100);\n                  app.flagCorrectAndTransition(app.terms[app.pointer - 1]);\n                  return;\n            }\n\n            //Similarity check by phonetics(ajax)\n            app.checkByPhonetic(spoken,correct).then(function(similarity) {\n              if (similarity===false) {\n                  return $.Deferred().reject();\n              }else{\n                  log.debug('PHP similarity: ' + spoken + ':' + correct +':' + similarity);\n                  app.showStarRating(similarity);\n                  if(similarity>=app.passmark) {\n                      app.flagCorrectAndTransition(similarity, app.terms[app.pointer - 1]);\n                  }\n              }//end of if check_by_phonetic result\n             });//end of check by phonetic\n\n        }//end of switch message type\n      };\n\n      //init cloudpoodll push recorder\n      cloudpoodll.init('speechcards_pushrecorder', theCallback);\n\n      //init streaming transcriber\n      var opts = {};\n      opts['language'] = app.props.language;\n      opts['region'] = app.props.region;\n      // opts['accessid']=app.props.accessid;\n      // opts['secretkey']=app.props.secretkey;\n      opts['token'] = app.props.token;\n      opts['parent'] = app.props.parent;\n      opts['owner'] = app.props.owner;\n      opts['appid'] = app.props.appid;\n      opts['expiretime'] = app.props.expiretime;\n\n      transcriber.init(opts);\n      transcriber.onFinalResult = function(transcript, result) {\n        var message = {\n          type: 'speech'\n        };\n        message.capturedspeech = transcript;\n        theCallback(message);\n      };\n    },\n\n    showStarRating(similarity){\n        //how many stars code\n        var stars = [true,true,true];\n        if(similarity<1){\n            stars=[true,true,false];\n        }\n        if(similarity<app.passmark){\n            stars=[true,false,false];\n        }\n        if(similarity<0.5){\n            stars=[false,false,false];\n        }\n        console.log(stars,similarity);\n\n        //prepare stars html\n        var code=\"\";\n        stars.forEach(function(star){\n            if(star===true){\n                code+='<i class=\"fa fa-star\"></i>';\n            }\n            else{\n                code+='<i class=\"fa fa-star-o\"></i>';\n            }\n        });\n        console.log(code);\n        $(\"#star-rating\").html(code);\n    },\n\n    flagCorrectAndTransition: function(term){\n\n        //update students word log if matched\n        app.check(true, term);\n\n        //transition if required\n        if (app.is_end()) {\n            app.update_header();\n            setTimeout(function() {\n                app.do_end();\n            }, 700);\n        } else {\n            setTimeout(function() {\n                app.do_next();\n            }, 700);\n        }\n\n    },\n\n    startAWSTranscriber: function() {\n      if (transcriber.active) {\n        return;\n      }\n      // first we get the microphone input from the browser (as a promise)...\n      window.navigator.mediaDevices.getUserMedia({\n        video: false,\n        audio: true,\n      }).then(function(stream) {\n        transcriber.start(stream, transcriber)\n      }).catch(function(error) {\n        log.debug(error);\n        log.debug('There was an error streaming your audio to Amazon Transcribe. Please try again.');\n      });\n    },\n\n    stopAWSTranscriber: function() {\n      if (!transcriber.active) {\n        return;\n      }\n      transcriber.closeSocket();\n    },\n\n    //this will return the promise, the result of which is an integer 100 being perfect match, 0 being no match\n    checkByPhonetic: function(spoken, correct){\n\n      return Ajax.call([{\n            'methodname': 'mod_wordcards_check_by_phonetic',\n            'args': {\n                'spoken': spoken,\n                'correct': correct,\n                'language': app.props.language,\n            }\n        }])[0];\n\n    },\n\n    wordsDoMatch: function(wordheard, currentterm) {\n      //lets lower case everything\n       wordheard = app.cleanText(wordheard);\n      currentterm.term = app.cleanText(currentterm.term);\n      if (wordheard == currentterm.term) {\n        return true;\n      }\n      if (!currentterm.alternates) {\n        return false;\n      }\n      var awords = currentterm.alternates.split(',');\n      var matched = false;\n      $.each(awords, function(i, word) {\n        if (app.cleanText(word.toLowerCase()) == wordheard) {\n          //we return false to break out of the loop, not to tell the parent its unmatched\n          matched = true;\n          return false;\n        }\n      });\n      return matched;\n    },\n\n    cleanText: function(text) {\n      return text.toLowerCase().replace(/[^\\w\\s]|_/g, \"\").replace(/\\s+/g, \" \").trim();\n    },\n\n    start: function() {\n      app.results = [];\n      a4e.shuffle(app.terms);\n      app.controls.vocab_list.hide();\n      app.controls.gameboard.show();\n      app.controls.time_counter.text(\"00:00\");\n      app.clearStarRating();\n      a4e.progress_dots(app.results, app.terms);\n      app.timer = {\n        interval: setInterval(function() {\n          app.timer.update();\n        }, 1000),\n        count: 0,\n        update: function() {\n          app.timer.count++;\n          app.controls.time_counter.text(a4e.pretty_print_secs(app.timer.count));\n        }\n      }\n      app.update_header();\n      this.initCards();\n    },\n    quit: function() {\n      clearInterval(app.timer.interval);\n      app.controls.gameboard.hide();\n      app.controls.vocab_list.show();\n    },\n\n    do_end: function() {\n      clearInterval(app.timer.interval);\n      $(\"#gameboard, #quit-button, #start-button\").hide();\n      $(\"#results\").show();\n\n      //template data\n      var tdata = [];\n      tdata['results'] = app.results;\n      tdata['total'] = app.terms.length;\n      tdata['totalcorrect'] = a4e.calc_total_points(app.results);\n      var total_time = app.timer.count;\n      if (total_time == 0) {\n        tdata['prettytime'] = '00:00';\n      } else {\n        tdata['prettytime'] = a4e.pretty_print_secs(total_time);\n      }\n      templates.render('mod_wordcards/feedback', tdata).then(\n        function(html, js) {\n          $(\"#results-inner\").html(html);\n        }\n      );\n\n      var data = {\n        results: app.results,\n        activity: \"speechcards\"\n      };\n      console.log(data);\n    },\n\n    is_end: function() {\n      if (app.pointer < app.terms.length) {\n        return false;\n      } else {\n        return true;\n      }\n    },\n\n    update_header: function() {\n\n      var progress = {\n        correct: app.results.filter(function(e) {\n          return e.points > 0\n        }).length / app.terms.length * 100,\n        incorrect: app.results.filter(function(e) {\n          return e.points == 0\n        }).length / app.terms.length * 100\n      }\n\n    },\n\n    check: function(correct, spokenwords) {\n      var points = 1;\n      if (correct == true) {\n        //createjs.Sound.play('correct');\n        points = 1;\n      } else {\n        points = 0;\n        //createjs.Sound.play('incorrect');\n      }\n      $(\".a4e-distractor\").css('pointer-events', 'none');\n      var result = {\n        pointer: app.pointer,\n        question: app.terms[app.pointer - 1]['definition'],\n        selected: spokenwords,\n        correct: app.terms[app.pointer - 1]['term'],\n        points: points\n      };\n\n      $.each(app.results, (function(result) {\n        if (app.pointer === result.pointer) {\n          //something here to remove the old result\n        }\n      }));\n      //finally add our result to the results\n      app.results.push(result);\n\n      //post results to server\n      if (correct) {\n        this.reportSuccess(app.terms[app.pointer - 1]['id']);\n      } else {\n        this.reportFailure(app.terms[app.pointer - 1]['id'], -1);\n      }\n\n    },\n\n    reportFailure: function(term1id, term2id) {\n      if (this.dryRun) {\n        return;\n      }\n\n      Ajax.call([{\n        methodname: 'mod_wordcards_report_failed_association',\n        args: {\n          term1id: term1id,\n          term2id: term2id\n        }\n      }]);\n    },\n\n    reportSuccess: function(termid) {\n      if (this.dryRun) {\n        return;\n      }\n\n      Ajax.call([{\n        methodname: 'mod_wordcards_report_successful_association',\n        args: {\n          termid: termid\n        }\n      }]);\n    },\n\n    similarity: function(s1, s2) {\n      var longer = s1;\n      var shorter = s2;\n      if (s1.length < s2.length) {\n        longer = s2;\n        shorter = s1;\n      }\n      var longerLength = longer.length;\n      if (longerLength == 0) {\n        return 1.0;\n      }\n      return (longerLength - app.editDistance(longer, shorter)) / parseFloat(longerLength);\n    },\n    editDistance: function(s1, s2) {\n      s1 = s1.toLowerCase();\n      s2 = s2.toLowerCase();\n\n      var costs = new Array();\n      for (var i = 0; i <= s1.length; i++) {\n        var lastValue = i;\n        for (var j = 0; j <= s2.length; j++) {\n          if (i == 0)\n            costs[j] = j;\n          else {\n            if (j > 0) {\n              var newValue = costs[j - 1];\n              if (s1.charAt(i - 1) != s2.charAt(j - 1))\n                newValue = Math.min(Math.min(newValue, lastValue),\n                  costs[j]) + 1;\n              costs[j - 1] = lastValue;\n              lastValue = newValue;\n            }\n          }\n        }\n        if (i > 0)\n          costs[s2.length] = lastValue;\n      }\n      return costs[s2.length];\n    }\n\n  };\n\n  return app;\n\n});"],"file":"speechcards.min.js"}