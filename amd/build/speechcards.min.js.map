{"version":3,"sources":["../src/speechcards.js"],"names":["define","$","Ajax","log","a4e","glidecards","cloudpoodll","transcriber","templates","app","pointer","whatheard","jsondata","props","glider","dryRun","controls","browserspeech","init","theid","widgetid","nexturl","get","JSON","parse","value","remove","debug","process","window","register_events","init_controls","close_results","results","vocab_list","question_counter","quit_button","the_list","gameboard","time_counter","progress_correct","progress_incorrect","prev_button","next_button","standalonepushrecorder","do_next","is_end","removeClass","text","go","update_header","do_end","do_prev","click","update_whatheard","failedword","terms","term","check","on","total_time","calc_total_time","location","replace","start","quit","has_images","list_vocab","initComponents","initCards","getScript","done","setPointer","newpointer","thelist","each","index","card","append","glide","type","autoplay","afterTransition","data","afterInit","theCallback","message","action","startAWSTranscriber","stopAWSTranscriber","speechtext","capturedspeech","cleanspeechtext","cleanText","wordsDoMatch","addClass","setTimeout","opts","language","region","accessid","secretkey","onFinalResult","transcript","active","navigator","mediaDevices","getUserMedia","video","audio","then","stream","catch","error","closeSocket","wordheard","currentterm","alternates","awords","split","matched","i","word","toLowerCase","trim","shuffle","hide","show","css","timer","interval","setInterval","update","count","pretty_print_secs","clearInterval","tdata","length","calc_total_points","render","html","activity","console","result","selected","progress","correct","filter","e","points","incorrect","spokenwords","question","time","push","reportSuccess","reportFailure","term1id","term2id","call","methodname","args","termid"],"mappings":"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","sourcesContent":["/**\n * Matching module.\n *\n * @package mod_wordcards\n * @author  Justin Hunt - poodll.com\n * * (based on Paul Raine's APPs 4 EFL)\n */\n\ndefine([\n'jquery',\n'core/ajax',\n'core/log',\n'mod_wordcards/a4e',\n'mod_wordcards/glidecards',\n'mod_wordcards/cloudpoodllloader',\n'mod_wordcards/transcriber-lazy',\n'core/templates'\n], function($, Ajax, log, a4e,glidecards,cloudpoodll,transcriber, templates) {\n\n    var app = {\n        pointer: 1,\n        whatheard: null,\n        jsondata: null,\n        props: null,\n        glider: null,\n        dryRun: false,\n        controls: {},\n        browserspeech: false,\n\n        init: function(props){\n\n            //pick up opts from html\n            var theid = '#' + props.widgetid;\n            this.dryRun=props.dryRun;\n            this.nexturl=props.nexturl;\n            var jsondata = $(theid).get(0);\n            if(jsondata){\n                var jsondata = JSON.parse(jsondata.value);\n                $(theid).remove();\n            }else{\n                //if there is no config we might as well give up\n                log.debug('No config found on page. Giving up.');\n                return;\n            }\n            app.jsondata = jsondata;\n            app.props=props;\n            app.process(jsondata);\n            app.whatheard = $('#submitted'); //$('#speechcards_whatheard');\n            //do we have in browser speech rec?\n            app.browserspeech =  'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;\n\n            a4e.register_events();\n            this.init_controls();\n            this.register_events();\n        },\n        init_controls: function(){\n            app.controls.close_results = $(\"#close-results\");\n            app.controls.results = $(\"#results\");\n            app.controls.vocab_list = $(\"#vocab-list\");\n            app.controls.question_counter = $(\"#question-counter\");\n            app.controls.quit_button = $(\"#quit-button\");\n            app.controls.the_list = $(\"#speechcards_thelist\");\n            app.controls.gameboard = $(\"#gameboard\");\n            app.controls.time_counter = $(\"#time-counter\");\n            app.controls.progress_correct = $(\"#progress-correct\");\n            app.controls.progress_incorrect = $(\"#progress-incorrect\");\n            app.controls.prev_button = $(\".wordcards-speechcards_prevbutton\");\n            app.controls.next_button = $(\".wordcards-speechcards_nextbutton\");\n            app.controls.standalonepushrecorder = $(\".speechcards_standalonerecorder\");\n        },\n        do_next: function() {\n            if(!app.is_end()) {\n                app.whatheard.removeClass('wordcards-speechcards_gotit');\n                app.whatheard.text('........');\n                app.glider.go('>');\n                app.update_header();\n            }else{\n                app.do_end();\n            }\n        },\n        do_prev: function() {\n            app.whatheard.removeClass('wordcards-speechcards_gotit');\n            app.whatheard.text('........');\n            app.glider.go('<');\n            app.update_header();\n        },\n\n        register_events: function(){\n\n            app.controls.prev_button.click(function(){\n                app.do_prev();\n                //if we have a result already for this result, display it\n                app.update_whatheard();\n            });\n            app.controls.next_button.click(function(){\n\n                //user has given up tryint pronounce it,update word as failed\n                var failedword =app.terms[app.pointer-1].term;\n                app.check(false,failedword);\n                app.do_next();\n\n                //if we have a result already for this result, display it\n                app.update_whatheard();\n            });\n\n\n            $('body').on('click',\"#close-results\",function(){\n                //try again with this one\n               // app.controls.results.hide();\n               // app.controls.vocab_list.show();\n\n                //\"finish\" with this one\n                var total_time=a4e.calc_total_time(app.results);\n                window.location.replace(app.nexturl.replace(/&amp;/g,'&') + \"&localscattertime=\" + total_time);\n            });\n\n            $('body').on('click','#start-button',function(){\n                app.start();\n            });\n\n\n            app.controls.quit_button.click(function(){\n                app.quit();\n            });\n        },\n\n        process:function(jsondata){\n\n            app.terms=jsondata.terms;\n            app.has_images=jsondata.has_images;\n            a4e.list_vocab(\"#vocab-list-inner\",app.terms);\n\n            //init components\n            this.initComponents();\n\n        },\n\n        initCards: function(){\n            $.getScript('https://cdn.jsdelivr.net/npm/glidejs@2.1.0/dist/glide.min.js').done(function() {\n\n                function setPointer(newpointer){\n                    app.pointer=newpointer;\n                }\n\n                //add speechcards\n                var li_template = \"<li class='glide__slide'><div class='wordcards-poodllspeechcards_box'>@thetext@</div></li>\";\n                var thelist = app.controls.the_list;\n\n                $.each(app.jsondata.terms, function (index,card) {\n                    thelist.append(li_template.replace('@thetext@', card.term))\n                });\n\n                app.glider = $(\"#speechcards_glide\").glide({\n                    type: \"carousel\",\n                    autoplay: false,\n                    afterTransition: function (data) {\n                        setPointer(data.index);\n                        app.update_header();\n                    },\n                    afterInit: function (data) {\n                        setPointer(data.index);\n                    },\n                }).data('glide_api');\n            });\n        },\n\n        initComponents: function(){\n\n            //The logic here is that on correct we transition.\n            //on incorrect we do not. A subsequent nav button click then doesnt need to post a result\n            var theCallback = function(message){\n                //console.log(message);\n                switch(message.type){\n                    case 'recording':\n                        //we only use AWS transcription is browserspeech is not available\n                        if(app.browserspeech){return;}\n\n                        //if using AWS transcriber\n                        if(message.action=='started'){\n                            app.startAWSTranscriber();\n                        }else if(message.action=='stopped'){\n                            app.stopAWSTranscriber();\n                        }\n                        break;\n\n                    case 'speech':\n                        var speechtext = message.capturedspeech;\n                        var cleanspeechtext = app.cleanText(speechtext);\n                        if(app.wordsDoMatch(cleanspeechtext,app.terms[app.pointer-1])){\n                            app.whatheard.text(app.terms[app.pointer-1].term);\n                            app.whatheard.addClass('wordcards-speechcards_gotit');\n                            app.check(true,cleanspeechtext);\n                            if(app.is_end()){\n                                app.update_header();\n                                setTimeout(function(){\n                                    app.do_end();\n                                },700);\n                            }else{\n                                setTimeout(function(){\n                                    app.do_next();\n                                },700);\n                            }\n\n                        }else{\n                            app.whatheard.text(speechtext);\n                            //we wont send false results until user gives up and clicks next\n                            //app.check(false,speechtext);\n                        }\n                }\n            };\n\n            //init cloudpoodll push recorder\n            cloudpoodll.init('speechcards_pushrecorder',theCallback);\n\n            //init streaming transcriber\n            var opts={};\n            opts['language']=app.props.language;\n            opts['region']=app.props.region;\n            opts['accessid']=app.props.accessid;\n            opts['secretkey']=app.props.secretkey;\n            transcriber.init(opts);\n            transcriber.onFinalResult =function(transcript,result){\n                var message ={type: 'speech'};\n                message.capturedspeech = transcript;\n                theCallback(message);\n            };\n        },\n\n        startAWSTranscriber: function(){\n            if(transcriber.active){return;}\n            // first we get the microphone input from the browser (as a promise)...\n            window.navigator.mediaDevices.getUserMedia({\n                video: false,\n                audio: true,\n            }).then(function (stream) {\n                transcriber.start(stream, transcriber)\n            }).catch(function (error) {\n                    log.debug(error);\n                    log.debug('There was an error streaming your audio to Amazon Transcribe. Please try again.');\n                }\n            );\n        },\n\n        stopAWSTranscriber: function(){\n            if(!transcriber.active){return;}\n            transcriber.closeSocket();\n        },\n\n        wordsDoMatch: function(wordheard, currentterm){\n            if(wordheard==currentterm.term){\n                return true;\n            }\n            if(!currentterm.alternates){\n                return false;\n            }\n            var awords = currentterm.alternates.split(',');\n            var matched =false;\n            $.each(awords,function(i,word){\n                if(app.cleanText(word)==wordheard){\n                    //this is to break out of the loop, not telling the parent its unmatched\n                    matched =true;\n                    return false;\n                }\n            });\n            return matched;\n        },\n\n        cleanText: function(text){\n            return text.toLowerCase().replace(/[^\\w\\s]|_/g, \"\").replace(/\\s+/g, \" \").trim();\n        },\n\n        start:function(){\n            app.results=[];\n            a4e.shuffle(app.terms);\n            app.controls.vocab_list.hide();\n            app.controls.gameboard.show();\n            app.controls.quit_button.show();\n            app.controls.time_counter.text(\"00:00\");\n            app.controls.progress_correct.css('width','0%');\n            app.controls.progress_incorrect.css('width','0%');\n            app.whatheard.text('........');\n            app.timer={\n                interval:setInterval(function(){ app.timer.update(); }, 1000),\n                count:0,\n                update:function(){\n                    app.timer.count++;\n                    app.controls.time_counter.text(a4e.pretty_print_secs(app.timer.count));\n                }\n            }\n            app.update_header();\n            this.initCards();\n        },\n        quit:function(){\n            clearInterval(app.timer.interval);\n            app.controls.gameboard.hide();\n            app.controls.quit_button.hide();\n            app.controls.vocab_list.show();\n        },\n\n        do_end:function(){\n            clearInterval(app.timer.interval);\n            $(\"#gameboard, #quit-button, #start-button\").hide();\n            $(\"#results\").show();\n\n            //template data\n            var tdata=[];\n            tdata['results']=app.results;\n            tdata['total']=app.terms.length;\n            tdata['totalcorrect']=a4e.calc_total_points(app.results);\n            var total_time=a4e.calc_total_time(app.results);\n            if(total_time==0){\n                tdata['prettytime']='00:00';\n            }else{\n                tdata['prettytime']=a4e.pretty_print_secs(total_time);\n            }\n            templates.render('mod_wordcards/feedback',tdata).then(\n                function(html,js){\n                    $(\"#results-inner\").html(html);\n                }\n            );\n\n            var data={\n                results:app.results,\n                activity:\"speechcards\"\n            };\n            console.log(data);\n        },\n\n        is_end:function(){\n            if(app.pointer<app.terms.length) {\n                return false;\n            }else{\n                return true;\n            }\n        },\n\n        update_whatheard: function(){\n            $.each(app.results,function(result){\n                if(app.pointer===result.pointer){\n                    app.whatheard.text(result.selected) ;\n                    if(app.cleanText(result.selected)===app.terms[app.pointer-1].term) {\n                        app.whatheard.addClass('wordcards-speechcards_gotit');\n                    }\n                }\n\n            });\n        },\n\n        update_header: function(){\n\n            var progress={\n                correct:app.results.filter(function(e){return e.points>0}).length/app.terms.length*100,\n                incorrect:app.results.filter(function(e){return e.points==0}).length/app.terms.length*100\n            }\n\n            app.controls.progress_correct.css('width',progress.correct+'%');\n            app.controls.progress_incorrect.css('width',progress.incorrect+'%');\n\n            app.controls.question_counter.text((app.pointer) + \"/\"+app.terms.length);\n\n        },\n\n        check:function(correct,spokenwords){\n            var points=1;\n            if(correct==true){\n                //createjs.Sound.play('correct');\n                points=1;\n            }\n            else{\n                points=0;\n                //createjs.Sound.play('incorrect');\n            }\n            $(\".a4e-distractor\").css('pointer-events','none');\n            var result={\n                pointer: app.pointer,\n                question:app.terms[app.pointer-1]['definition'],\n                selected:spokenwords,\n                correct:app.terms[app.pointer-1]['term'],\n                points: points,\n                time: app.timer.count\n            };\n            app.timer.count=0;\n            $.each(app.results,(function(result){\n                if(app.pointer===result.pointer){\n                    //something here to remove the old result\n                }\n            }));\n            //finally add our result to the results\n            app.results.push(result);\n\n            //post results to server\n            if(correct){\n                this.reportSuccess(app.terms[app.pointer-1]['id']);\n            }else{\n                this.reportFailure(app.terms[app.pointer-1]['id'],-1);\n            }\n\n        },\n\n\n        reportFailure: function(term1id, term2id) {\n            if (this.dryRun) {\n                return;\n            }\n\n            Ajax.call([{\n                methodname: 'mod_wordcards_report_failed_association',\n                args: {\n                    term1id: term1id,\n                    term2id: term2id\n                }\n            }]);\n        },\n\n        reportSuccess: function(termid) {\n            if (this.dryRun) {\n                return;\n            }\n\n            Ajax.call([{\n                methodname: 'mod_wordcards_report_successful_association',\n                args: {\n                    termid: termid\n                }\n            }]);\n        }\n    };\n\n    return app;\n\n});\n"],"file":"speechcards.min.js"}