{"version":3,"sources":["../src/speechcards.js"],"names":["define","$","Ajax","log","a4e","glidecards","cloudpoodll","transcriber","templates","app","pointer","whatheard","jsondata","props","glider","dryRun","controls","browserspeech","init","theid","widgetid","nexturl","get","JSON","parse","value","remove","debug","window","process","register_events","init_controls","close_results","results","vocab_list","quit_button","the_list","gameboard","time_counter","prev_button","next_button","standalonepushrecorder","do_next","is_end","removeClass","text","go","update_header","do_end","do_prev","click","update_whatheard","failedword","terms","term","check","on","total_time","calc_total_time","url","replace","location","reload","start","quit","has_images","list_vocab","initComponents","initCards","getScript","done","setPointer","newpointer","thelist","each","index","card","append","glide","type","autoplay","afterTransition","data","afterInit","theCallback","message","action","startAWSTranscriber","stopAWSTranscriber","speechtext","capturedspeech","cleanspeechtext","cleanText","wordsDoMatch","addClass","setTimeout","opts","language","region","token","parent","owner","appid","expiretime","onFinalResult","transcript","active","navigator","mediaDevices","getUserMedia","video","audio","then","stream","catch","error","closeSocket","wordheard","currentterm","alternates","awords","split","matched","i","word","toLowerCase","trim","shuffle","hide","show","timer","interval","setInterval","update","count","pretty_print_secs","clearInterval","tdata","length","calc_total_points","render","html","activity","console","result","selected","correct","filter","e","points","incorrect","spokenwords","css","question","time","push","reportSuccess","reportFailure","term1id","term2id","call","methodname","args","termid"],"mappings":"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","sourcesContent":["/**\n * Matching module.\n *\n * @package mod_wordcards\n * @author  Justin Hunt - poodll.com\n * * (based on Paul Raine's APPs 4 EFL)\n */\n\ndefine([\n  'jquery',\n  'core/ajax',\n  'core/log',\n  'mod_wordcards/a4e',\n  'mod_wordcards/glidecards',\n  'mod_wordcards/cloudpoodllloader',\n  'mod_wordcards/transcriber-lazy',\n  'core/templates'\n], function($, Ajax, log, a4e, glidecards, cloudpoodll, transcriber, templates) {\n\n  var app = {\n    pointer: 1,\n    whatheard: null,\n    jsondata: null,\n    props: null,\n    glider: null,\n    dryRun: false,\n    controls: {},\n    browserspeech: false,\n\n    init: function(props) {\n\n      //pick up opts from html\n      var theid = '#' + props.widgetid;\n      this.dryRun = props.dryRun;\n      this.nexturl = props.nexturl;\n      var jsondata = $(theid).get(0);\n      if (jsondata) {\n        var jsondata = JSON.parse(jsondata.value);\n        $(theid).remove();\n      } else {\n        //if there is no config we might as well give up\n        log.debug('No config found on page. Giving up.');\n        return;\n      }\n      app.jsondata = jsondata;\n      app.props = props;\n      app.browserspeech = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;\n      app.process(jsondata);\n      app.whatheard = $('#submitted'); //$('#speechcards_whatheard');\n      //do we have in browser speech rec?\n\n\n      a4e.register_events();\n      this.init_controls();\n      this.register_events();\n    },\n    init_controls: function() {\n      app.controls.close_results = $(\"#close-results\");\n      app.controls.results = $(\"#results\");\n      app.controls.vocab_list = $(\"#vocab-list\");\n      app.controls.quit_button = $(\"#quit-button\");\n      app.controls.the_list = $(\"#speechcards_thelist\");\n      app.controls.gameboard = $(\"#gameboard\");\n      app.controls.time_counter = $(\"#time-counter\");\n      app.controls.prev_button = $(\".wordcards-speechcards_prevbutton\");\n      app.controls.next_button = $(\".wordcards-speechcards_nextbutton\");\n      app.controls.standalonepushrecorder = $(\".speechcards_standalonerecorder\");\n    },\n    do_next: function() {\n      if (!app.is_end()) {\n        app.whatheard.removeClass('wordcards-speechcards_gotit');\n        app.whatheard.text('........');\n        app.glider.go('>');\n        app.update_header();\n      } else {\n        app.do_end();\n      }\n    },\n    do_prev: function() {\n      app.whatheard.removeClass('wordcards-speechcards_gotit');\n      app.whatheard.text('........');\n      app.glider.go('<');\n      app.update_header();\n    },\n\n    register_events: function() {\n\n      app.controls.prev_button.click(function() {\n        app.do_prev();\n        //if we have a result already for this result, display it\n        app.update_whatheard();\n      });\n      app.controls.next_button.click(function() {\n\n        //user has given up tryint pronounce it,update word as failed\n        var failedword = app.terms[app.pointer - 1].term;\n        app.check(false, failedword);\n        app.do_next();\n\n        //if we have a result already for this result, display it\n        app.update_whatheard();\n      });\n\n      $('body').on('click', \"#close-results\", function() {\n\n        var total_time = a4e.calc_total_time(app.results);\n        var url = app.nexturl.replace(/&amp;/g, '&') + \"&localscattertime=\" + total_time\n        window.location.replace(url);\n\n      });\n\n      $('body').on('click', \"#try-again\", function() {\n        location.reload();\n      });\n\n      $('body').on('click', '#start-button', function() {\n        app.start();\n      });\n\n      app.controls.quit_button.click(function() {\n        app.quit();\n      });\n    },\n\n    process: function(jsondata) {\n\n      app.terms = jsondata.terms;\n      app.has_images = jsondata.has_images;\n      a4e.list_vocab(\"#vocab-list-inner\", app.terms);\n\n      //init components\n      this.initComponents();\n\n    },\n\n    initCards: function() {\n      $.getScript('https://cdn.jsdelivr.net/npm/glidejs@2.1.0/dist/glide.min.js').done(function() {\n\n        function setPointer(newpointer) {\n          app.pointer = newpointer;\n        }\n\n        //add speechcards\n        var li_template = \"<li class='glide__slide'><div class='wordcards-poodllspeechcards_box'>@thetext@</div></li>\";\n        var thelist = app.controls.the_list;\n\n        $.each(app.jsondata.terms, function(index, card) {\n          thelist.append(li_template.replace('@thetext@', card.term))\n        });\n\n        app.glider = $(\"#speechcards_glide\").glide({\n          type: \"carousel\",\n          autoplay: false,\n          afterTransition: function(data) {\n            setPointer(data.index);\n            app.update_header();\n          },\n          afterInit: function(data) {\n            setPointer(data.index);\n          },\n        }).data('glide_api');\n      });\n    },\n\n    initComponents: function() {\n\n      //The logic here is that on correct we transition.\n      //on incorrect we do not. A subsequent nav button click then doesnt need to post a result\n      var theCallback = function(message) {\n        //console.log(message);\n        switch (message.type) {\n          case 'recording':\n            //we only use AWS transcription is browserspeech is not available\n            if (app.browserspeech) {\n              return;\n            }\n\n            //if using AWS transcriber\n            if (message.action == 'started') {\n              app.startAWSTranscriber();\n            } else if (message.action == 'stopped') {\n              app.stopAWSTranscriber();\n            }\n            break;\n\n          case 'speech':\n            var speechtext = message.capturedspeech;\n            var cleanspeechtext = app.cleanText(speechtext);\n            if (app.wordsDoMatch(cleanspeechtext, app.terms[app.pointer - 1])) {\n              app.whatheard.text(app.terms[app.pointer - 1].term);\n              app.whatheard.addClass('wordcards-speechcards_gotit');\n              app.check(true, cleanspeechtext);\n              if (app.is_end()) {\n                app.update_header();\n                setTimeout(function() {\n                  app.do_end();\n                }, 700);\n              } else {\n                setTimeout(function() {\n                  app.do_next();\n                }, 700);\n              }\n\n            } else {\n              app.whatheard.text(speechtext);\n              //we wont send false results until user gives up and clicks next\n              //app.check(false,speechtext);\n            }\n        }\n      };\n\n      //init cloudpoodll push recorder\n      cloudpoodll.init('speechcards_pushrecorder', theCallback);\n\n      //init streaming transcriber\n      var opts = {};\n      opts['language'] = app.props.language;\n      opts['region'] = app.props.region;\n      // opts['accessid']=app.props.accessid;\n      // opts['secretkey']=app.props.secretkey;\n      opts['token'] = app.props.token;\n      opts['parent'] = app.props.parent;\n      opts['owner'] = app.props.owner;\n      opts['appid'] = app.props.appid;\n      opts['expiretime'] = app.props.expiretime;\n\n      transcriber.init(opts);\n      transcriber.onFinalResult = function(transcript, result) {\n        var message = {\n          type: 'speech'\n        };\n        message.capturedspeech = transcript;\n        theCallback(message);\n      };\n    },\n\n    startAWSTranscriber: function() {\n      if (transcriber.active) {\n        return;\n      }\n      // first we get the microphone input from the browser (as a promise)...\n      window.navigator.mediaDevices.getUserMedia({\n        video: false,\n        audio: true,\n      }).then(function(stream) {\n        transcriber.start(stream, transcriber)\n      }).catch(function(error) {\n        log.debug(error);\n        log.debug('There was an error streaming your audio to Amazon Transcribe. Please try again.');\n      });\n    },\n\n    stopAWSTranscriber: function() {\n      if (!transcriber.active) {\n        return;\n      }\n      transcriber.closeSocket();\n    },\n\n    wordsDoMatch: function(wordheard, currentterm) {\n      //lets lower case everything\n      wordheard = app.cleanText(wordheard);\n      currentterm.term = app.cleanText(currentterm.term);\n      if (wordheard == currentterm.term) {\n        return true;\n      }\n      if (!currentterm.alternates) {\n        return false;\n      }\n      var awords = currentterm.alternates.split(',');\n      var matched = false;\n      $.each(awords, function(i, word) {\n        if (app.cleanText(word.toLowerCase()) == wordheard) {\n          //we return false to break out of the loop, not to tell the parent its unmatched\n          matched = true;\n          return false;\n        }\n      });\n      return matched;\n    },\n\n    cleanText: function(text) {\n      return text.toLowerCase().replace(/[^\\w\\s]|_/g, \"\").replace(/\\s+/g, \" \").trim();\n    },\n\n    start: function() {\n      app.results = [];\n      a4e.shuffle(app.terms);\n      app.controls.vocab_list.hide();\n      app.controls.gameboard.show();\n      app.controls.quit_button.show();\n      app.controls.time_counter.text(\"00:00\");\n      app.whatheard.text('........');\n      app.timer = {\n        interval: setInterval(function() {\n          app.timer.update();\n        }, 1000),\n        count: 0,\n        update: function() {\n          app.timer.count++;\n          app.controls.time_counter.text(a4e.pretty_print_secs(app.timer.count));\n        }\n      }\n      app.update_header();\n      this.initCards();\n    },\n    quit: function() {\n      clearInterval(app.timer.interval);\n      app.controls.gameboard.hide();\n      app.controls.quit_button.hide();\n      app.controls.vocab_list.show();\n    },\n\n    do_end: function() {\n      clearInterval(app.timer.interval);\n      $(\"#gameboard, #quit-button, #start-button\").hide();\n      $(\"#results\").show();\n\n      //template data\n      var tdata = [];\n      tdata['results'] = app.results;\n      tdata['total'] = app.terms.length;\n      tdata['totalcorrect'] = a4e.calc_total_points(app.results);\n      var total_time = a4e.calc_total_time(app.results);\n      if (total_time == 0) {\n        tdata['prettytime'] = '00:00';\n      } else {\n        tdata['prettytime'] = a4e.pretty_print_secs(total_time);\n      }\n      templates.render('mod_wordcards/feedback', tdata).then(\n        function(html, js) {\n          $(\"#results-inner\").html(html);\n        }\n      );\n\n      var data = {\n        results: app.results,\n        activity: \"speechcards\"\n      };\n      console.log(data);\n    },\n\n    is_end: function() {\n      if (app.pointer < app.terms.length) {\n        return false;\n      } else {\n        return true;\n      }\n    },\n\n    update_whatheard: function() {\n      $.each(app.results, function(result) {\n        if (app.pointer === result.pointer) {\n          app.whatheard.text(result.selected);\n          if (app.cleanText(result.selected) === app.terms[app.pointer - 1].term) {\n            app.whatheard.addClass('wordcards-speechcards_gotit');\n          }\n        }\n\n      });\n    },\n\n    update_header: function() {\n\n      var progress = {\n        correct: app.results.filter(function(e) {\n          return e.points > 0\n        }).length / app.terms.length * 100,\n        incorrect: app.results.filter(function(e) {\n          return e.points == 0\n        }).length / app.terms.length * 100\n      }\n\n    },\n\n    check: function(correct, spokenwords) {\n      var points = 1;\n      if (correct == true) {\n        //createjs.Sound.play('correct');\n        points = 1;\n      } else {\n        points = 0;\n        //createjs.Sound.play('incorrect');\n      }\n      $(\".a4e-distractor\").css('pointer-events', 'none');\n      var result = {\n        pointer: app.pointer,\n        question: app.terms[app.pointer - 1]['definition'],\n        selected: spokenwords,\n        correct: app.terms[app.pointer - 1]['term'],\n        points: points,\n        time: app.timer.count\n      };\n      app.timer.count = 0;\n      $.each(app.results, (function(result) {\n        if (app.pointer === result.pointer) {\n          //something here to remove the old result\n        }\n      }));\n      //finally add our result to the results\n      app.results.push(result);\n\n      //post results to server\n      if (correct) {\n        this.reportSuccess(app.terms[app.pointer - 1]['id']);\n      } else {\n        this.reportFailure(app.terms[app.pointer - 1]['id'], -1);\n      }\n\n    },\n\n\n    reportFailure: function(term1id, term2id) {\n      if (this.dryRun) {\n        return;\n      }\n\n      Ajax.call([{\n        methodname: 'mod_wordcards_report_failed_association',\n        args: {\n          term1id: term1id,\n          term2id: term2id\n        }\n      }]);\n    },\n\n    reportSuccess: function(termid) {\n      if (this.dryRun) {\n        return;\n      }\n\n      Ajax.call([{\n        methodname: 'mod_wordcards_report_successful_association',\n        args: {\n          termid: termid\n        }\n      }]);\n    }\n  };\n\n  return app;\n\n});"],"file":"speechcards.min.js"}