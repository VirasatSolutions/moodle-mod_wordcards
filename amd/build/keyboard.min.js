define(["jquery"],function(a){var b={string:"",letters:[],qwerty:[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l"],["z","x","c","v","b","n","m"]],mobile_user:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},shuffle:function(a){var b,c,d;for(d=a.length;d;d-=1)b=Math.floor(Math.random()*d),c=a[d-1],a[d-1]=a[b],a[b]=c},flash:function(b,c){a(b).addClass(c),setTimeout(function(){a(b).removeClass(c)},100)},off:function(){a("body").off(b.mobile_user()?"touchstart":"click",".chunk-key").off("click","#delete-chunk-input").off("click","#clear-chunk-input").off("click","#submit-chunk-input").off("keypress").off("keydown")},clear:function(){b.off(),a("#chunk-input").remove()},disable:function(){b.off(),a("#chunk-typed-inner").text(""),a("#chunk-input").addClass("chunk-input-disabled")},create:function(c,d,e,f,g){var h=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];b.string=d,b.clear(),b.letters=[],a.each(d.split(""),function(a,c){b.letters.indexOf(c)==-1&&(b.letters.push(c),h.splice(h.indexOf(c),1))}),b.shuffle(h),f&&(b.letters=b.letters.concat(h.slice(0,3))),b.letters.sort();var i="<div id='chunk-input' data-id='"+e+"' class='noselect'>";i+="<div id='chunk-typed'><div id='chunk-typed-inner'></div></div>",a.each(b.letters,function(a,b){i+="<div class='chunk-key' data-val='"+b.charCodeAt(0)+"'><div class='chunk-key-inner'>"+(" "==b?"&nbsp;":b)+"</div></div>"}),i+="<div id='chunk-input-controls'>",i+="<div id='delete-chunk-input' class='btn-primary chunk-input-control'><i class='fa fa-caret-square-o-left'></i> Delete</div>",i+="<div id='submit-chunk-input' class='btn-success chunk-input-control'>Submit <i class='fa fa-arrow-circle-right'></i></div>",i+="</div>",i+="</div>",a("#"+c).html(i),a("body").on(b.mobile_user()?"touchstart":"click",".chunk-key",function(){var c=a("#chunk-typed-inner").text();c.length<d.length?b.press(this,g):b.flash("#chunk-typed-inner","a4e-incorrect")}),a("body").on("touchmove","#"+c,function(a){a.preventDefault()}),a("body").on("click","#delete-chunk-input",function(){var b=a("#chunk-typed-inner").text();b.slice(-1).charCodeAt(0);a("#chunk-typed-inner").text(b.substring(0,b.length-1))}),a("body").on("click","#submit-chunk-input",function(){var b=a("#chunk-typed-inner").text();g(b)}),a("body").on("keydown",function(b){var c=b.which;[0,8,46].indexOf(c)!=-1?(a("#delete-chunk-input").trigger("click"),b.preventDefault()):13==b.which&&(a("#submit-chunk-input").trigger("click"),b.preventDefault())}),a("body").on("keypress",function(c){var e=a("#chunk-typed-inner").text(),f=c.which,h=a(".chunk-key[data-val='"+f+"']");h.length&&e.length<d.length?b.press(h,g):b.flash("#chunk-typed-inner","a4e-incorrect"),c.preventDefault()})},press:function(c,d){var e=String.fromCharCode(a(c).data("val"));b.flash(c,"a4e-key-pressed");var f={old:a("#chunk-typed-inner").text()};f["new"]=f.old+e,f["new"].length<=b.string.length?a("#chunk-typed-inner").text(f["new"]):b.flash("#chunk-typed-inner","a4e-incorrect")}};return b});