define(["jquery","core/templates"],function(a,b){var c={string:"",letters:[],qwerty:[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l"],["z","x","c","v","b","n","m"]],mobile_user:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},shuffle:function(a){var b,c,d;for(d=a.length;d;d-=1)b=Math.floor(Math.random()*d),c=a[d-1],a[d-1]=a[b],a[b]=c},flash:function(b,c){a(b).addClass(c),setTimeout(function(){a(b).removeClass(c)},100)},off:function(){a("body").off(c.mobile_user()?"touchstart":"click",".chunk-key").off("click","#delete-chunk-input").off("click","#clear-chunk-input").off("click","#submit-chunk-input").off("keypress").off("keydown")},clear:function(){c.off(),a("#chunk-input").remove()},disable:function(){c.off(),a("#chunk-typed-inner").text(""),a("#chunk-input").addClass("chunk-input-disabled")},create:function(d,e,f,g,h){var i=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];c.string=e,c.off(),c.letters=[],a.each(e.split(""),function(a,b){c.letters.indexOf(b)==-1&&(c.letters.push(b),i.splice(i.indexOf(b),1))}),c.shuffle(i),g&&(c.letters=c.letters.concat(i.slice(0,3))),c.letters.sort();var j=[];a.each(c.letters,function(a,b){var c={};c.charcode=b.charCodeAt(0)," "==b?c.letter="&nbsp;":c.letter=b,j.push(c)});var k=[];k.letters=j,b.render("mod_wordcards/keyboard",k).then(function(b,c){a("#"+d).html(b)}),a("body").on(c.mobile_user()?"touchstart":"click",".chunk-key",function(){var b=a("#chunk-typed-inner").text();b.length<e.length?c.press(this,h):c.flash("#chunk-typed-inner","a4e-incorrect")}),a("body").on("touchmove","#"+d,function(a){a.preventDefault()}),a("body").on("click","#delete-chunk-input",function(){var b=a("#chunk-typed-inner").text();b.slice(-1).charCodeAt(0);a("#chunk-typed-inner").text(b.substring(0,b.length-1))}),a("body").on("click","#submit-chunk-input",function(){var b=a("#chunk-typed-inner").text();h(b)}),a("body").on("keydown",function(b){var c=b.which;[0,8,46].indexOf(c)!=-1?(a("#delete-chunk-input").trigger("click"),b.preventDefault()):13==b.which&&(a("#submit-chunk-input").trigger("click"),b.preventDefault())}),a("body").on("keypress",function(b){var d=a("#chunk-typed-inner").text(),f=b.which,g=a(".chunk-key[data-val='"+f+"']");g.length&&d.length<e.length?c.press(g,h):c.flash("#chunk-typed-inner","a4e-incorrect"),b.preventDefault()})},press:function(b,d){var e=String.fromCharCode(a(b).data("val"));c.flash(b,"a4e-key-pressed");var f={old:a("#chunk-typed-inner").text()};f["new"]=f.old+e,f["new"].length<=c.string.length?a("#chunk-typed-inner").text(f["new"]):c.flash("#chunk-typed-inner","a4e-incorrect")}};return c});